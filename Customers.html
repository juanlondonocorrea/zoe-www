<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Customers</title>

		<link rel="stylesheet" href="css/themes/zoe.min.css" />
		<link rel="stylesheet" href="css/themes/jquery.mobile.icons.min.css" />
		<link rel="stylesheet" href="js/jquery-mobile/jquery.mobile.structure-1.4.5.min.css" />

		<!--  <link rel="stylesheet" href="js/jquery-mobile/jquery.mobile-1.4.5.min.css" />  -->
		<script src="js/jquery-mobile/jquery-2.1.4.js"></script>
		<script src="js/jquery-mobile/jquery.mobile-1.4.5.min.js"></script>
		<script type="text/javascript" src="cordova.js"></script>
		<script src="js/zoe/zoe.js"></script>
		<script src="js/zoe/customerDAO.js"></script>
        <script src="js/zoe/termDAO.js"></script>
        <script src="js/zoe/pricelevelDAO.js"></script>
        <script src="js/zoe/invoiceDAO.js"></script>
        <script src="js/zoe/salesRepDAO.js"></script>
        <script src="js/zoe/creditMemoDAO.js"></script>
		<script> 

			$(document).bind("pageinit", function(event) {
				initAnyPage(event.target);
				initThisPage(event);
			});
			
			var type="";
			function initThisPage(event){ 
				//receiveCustomers();
				type="";

				if (event && event.currentTarget && event.currentTarget.URL){
					console.log("event.currentTarget.URL: "+event.currentTarget.URL);
					type = event.currentTarget.URL.split("?type=")[1];
				}

				if (type=="route" || window.localStorage.getItem("current_type") == "route"){
					var routeDay = (new Date()).getDay()+1;
					console.log("routeDay="+ routeDay);
					customerDAO.listByRouteDay(routeDay, receiveCustomers,errReceiveCustomers);
					console.log("zoeTitle="+ $("#zoeTitle"));
					console.log("zoeTitle.innerHtml="+ $("#zoeTitle").innerHtml);
					console.log("zoeTitle.html="+ $("#zoeTitle").html());
					$("#zoeTitle").html($("#zoeTitle").html() + " route day " + routeDay);
					console.log("zoeTitle="+ $("#zoeTitle").html());
					$("#customerType").html("Customer on route today");
				}else{
					customerDAO.list(receiveCustomers, errReceiveCustomers);
				}
				salesRepDAO.getByName(window.localStorage.getItem("salesRepName"), receiveSalesRep);
			}
			
			var salesRepVO;
			function receiveSalesRep(vo){
				salesRepVO = vo;
			}

			// BEGIN Functions on error case
			function errReceiveCustomers(err){
				alert("DB Error customers: "+JSON.stringify(err));
			}
			
			function errReceiveTerms(err){
				alert("DB Error terms: "+JSON.stringify(err));
			}
			
			function errPriceLevel(err){
				alert("DB Error Price Level: "+JSON.stringify(err));
			}
			
			function errListInvoicesByCustomer(err){
				alert("DB Error ListInvoicesByCustomer: "+JSON.stringify(err));
			}
			function errListCreditMemosByCustomer(err){
				alert("DB Error ListCreditMemosByCustomer: "+JSON.stringify(err));
			}			
			// END functions on error case
			
			$(document).bind('pagechange', function() {
				try{
					$('.ui-page-active .ui-listview').listview('refresh');
					$('.ui-page-active :jqmData(role=content)').trigger('create');
				}catch(exception){
				}
			});	

			// Copy bill fileds to ship fields
			function BillToShipCopy(){
				copyState = $('#copyBillToShip').is(':checked');
				if (copyState == true) { // Copy Bill to Ship
					$('#shipAddress1').val($('#billAddress1').val());
					$('#shipAddress2').val($('#billAddress2').val());
					$('#shipAddress3').val($('#billAddress3').val());
					$('#shipCity').val($('#billCity').val());
					$('#shipState').val($('#billState').val());
					$('#shipZipCode').val($('#billZipCode').val());
					$('#shipCountry').val($('#billCountry').val());
				}
			}

/*			// Esto es para colorear en rojo los valores negativos - PENDIENTE POR TERMINA
			$(document).ready(function(){ 
			$("td .ms-vb2").each(function () {
			   if($(this).val().indexof('-') > -1)
				{
				  $(this).css("color", "Crimson");
				}
			})  
			});			
*/
			$(document).ready(function(){ 
			$("#custList .li").each(function () {
			   if($(this).val().indexof('-') > -1)
				{
				  $(this).css("color", "Crimson");
				}
			})  
			});			

			function openBalanceRed(){ // Colocar valor en rojo para openBalance en la lista
				if ($('#openBalance').val() < 0) {
					$("#openBalance").css("color", "Crimson");
				} else {
					$("#openBalance").css("color", "black");
				}
			}
			
			function overdueBalanceRed(){ // Colocar valor en rojo para overdueBalance en Customers Details
				if ($('#openBalance').val() < 0) {
					$("#openBalance").css("color", "Crimson");
				} else {
					$("#openBalance").css("color", "black");
				}
			}
			
			function onClickInvoicePreview(id_invoice){
				window.localStorage.setItem("current_index_customer", selectedIndex);
				console.log("onClickInvoicePreview current_index_customer=" + window.localStorage.getItem("current_index_customer"));
				window.localStorage.setItem("current_type", type);
			}
			
			var id_invoicePhoto;
			function onClickGetPhoto(id_invoice){
				id_invoicePhoto = id_invoice;
				navigator.camera.getPicture( photoSuccess, photoError, {quality: 20, destinationType: Camera.DestinationType.DATA_URL, encodingType: Camera.EncodingType.JPEG} );
			}
			
			function photoSuccess(imageData){
				var invoiceVO = {
					id_invoice: id_invoicePhoto,
					photo: imageData
				}
				invoiceDAO.storePhoto(invoiceVO, photoStoreFail, photoStoreSuccess);
			}
			
			function photoStoreSuccess(){
				alert("success: photo stored");
			}
			
			function photoStoreFail(err){
				alert("fail: the photo was not stored error:" + JSON.stringify(err));
			}

			function photoError(){
				alert("error photo");
			}
			
			// Función para calcular los días transcurridos entre dos fechas
			restaFechas = function(f1,f2)
			 {
				 var aFecha1 = f1.split('-'); 
				 //var aFecha2 = f2.split('-');
				 var fFecha1 = Date.UTC(aFecha1[0],aFecha1[1]-1,aFecha1[2]); 
				 var fFecha2 = f2; //Date.UTC(aFecha2[0],aFecha2[1]-1,aFecha2[2]);
				 var dif = fFecha2 - fFecha1;
				 var dias = Math.floor(dif / (1000 * 60 * 60 * 24));
				 return dias;
			 }			

			// Populate Customers list
			var listCustomers = new Array();
			var selectedIndex;
			function receiveCustomers(arrayCustomers){
				console.log("receiveCustomers arrayCustomers=" + JSON.stringify(arrayCustomers));
				listCustomers = arrayCustomers; // Copy local array to global array
				console.log("========= INICIO LISTA =========");
				// Build customers list with <ol> <li>
				var htmlString1 = "";
				
				for(var i=0; i< arrayCustomers.length; i++) {
				/*	if (arrayCustomers[i].openBalance < 0) {
						$("#openB").css("color", "Crimson");
					}
					else {
						$("#openB").css("color", "black");
					} */
					var li =  '<li data-filtertext="' + arrayCustomers[i].FullName + '"><a class="linkDetail" href="#CustomersDetails?index=' + i + '" id="link_' + i + '" ><h3>'+arrayCustomers[i].FullName+'</h3><p>' + ((type=='route')?'Total sales':'Balance') + '</p><span id="openB" class="ui-li-count">'+((type=='route')?arrayCustomers[i].salesofday:arrayCustomers[i].openBalance)+'</span></a><a class="linkDetail" href="#CustomersDetails?index=' + i + '" id="link_' + i + '">Predet.</a></li>';
					
					htmlString1 += li;
					console.log("li=" + li);					
					}
					console.log("========= FIN LISTA =========");
					try{$('#custList').html(htmlString1).listview('refresh');}catch(e){}
					$(".linkDetail").click(goDetail); 
					console.log("current_index_customer="+window.localStorage.getItem("current_index_customer"));
					if (window.localStorage.getItem("current_index_customer")){
						selectedIndex = window.localStorage.getItem("current_index_customer");
						renderDetail(window.localStorage.getItem("current_index_customer"));
						window.localStorage.removeItem("current_index_customer");
					}
			}
			
			function receiveTerms(arrayTerms){
				$('#Terms').empty();
				var toSelectIndex = 0;
				for (var i in arrayTerms) {
					if (arrayTerms[i].id_term == listCustomers[selectedIndex].id_term){
						toSelectIndex=i;
					}
					var option='<option value="'+arrayTerms[i].id_term+'">'+arrayTerms[i].name+'</option>'
					$('#Terms').append(option);					
				}
				$('#Terms')[0].selectedIndex = toSelectIndex;
				$('#Terms').selectmenu('refresh');
				$('#Terms').trigger("chosen:updated");
			}

			function receivePriceLevel(arrayPriceList){
				$('#priceLevel').empty();
				var toSelectIndex = 0;
				for (var i in arrayPriceList) {
					if (arrayPriceList[i].ListID == listCustomers[selectedIndex].pricelevel_ListID){
						toSelectIndex=i;
					}
					var option='<option value="'+arrayPriceList[i].ListID+'">'+arrayPriceList[i].name+'</option>'
					$('#priceLevel').append(option);
				}
				$('#priceLevel')[0].selectedIndex = toSelectIndex;
				$('#priceLevel').selectmenu('refresh');
				$('#priceLevel').trigger("chosen:updated");
			}
			
			
			// List Invoices by Customer 
			var listInvoices = new Array();
			var selectedIndex2;
			function receiveInvoices(arrayListInvoicesByCust){
				listInvoices = arrayListInvoicesByCust; // Copy local array to global array
				// Build customers' invoices by Customer, list with <ul> <li>
				var htmlString2 = '<ul id="listInvoiceByCust" data-role="listview" data-filter="true" data-filter-placeholder="Search invoice..."  style="padding-left:0px !important; padding-right:0px !important">';
				var hoy=Date.now(); // Current date in milliseconds
				var TotBalanceRem = 0.00;
				var TotAmount = 0.00;
				
				for(var i=0; i< arrayListInvoicesByCust.length; i++) {
						var dueDays = restaFechas(arrayListInvoicesByCust[i].dueDate,hoy); // Date in format yyyy-mm-dd
						if (dueDays<0){
							dueDays = 0;
						}
						var monsthsAgo = dueDays/30;
						monsthsAgo = monsthsAgo.toFixed(1); // Calc months with 1 decimal number
						htmlString2 += '<li data-filtertext="' + arrayListInvoicesByCust[i].id_invoice + '">'+
						'<table width="100%" border="0" style="border:none !important;"><tr><td width="80%" valign="top" style="border:none;">Invoice #' + arrayListInvoicesByCust[i].refNumber +
						'<div>Amount: <span id="overdueBal">'+arrayListInvoicesByCust[i].appliedAmount+'</span><br/>Balance Remaining:<span> '+arrayListInvoicesByCust[i].balanceRemaining+'</span><br/>';
						if (dueDays>0){
							htmlString2 +='<span id="OberdueBy">Overdue by '+dueDays+' days</span><br/><span id="AddedMonthsAgo">Added '+monsthsAgo+' months ago</span>';
						}
						htmlString2 +='</div></td><td width="20%"  valign="top" style="border:none;">';
						if (arrayListInvoicesByCust[i].origin == 'local'){
							htmlString2 += '<a href="invoice.html?id_invoice=' + arrayListInvoicesByCust[i].id_invoice + '" class="ui-btn ui-btn-icon-notext ui-corner-all ui-icon-edit"  data-ajax="false"></a>';
						}
						htmlString2 +='<a href="InvoicePreview.html?id_invoice=' + arrayListInvoicesByCust[i].id_invoice +
						'" class="ui-btn ui-btn-icon-notext ui-icon-print ui-corner-all" data-ajax="false" onClick="onClickInvoicePreview(\''+ arrayListInvoicesByCust[i].id_invoice + '\'); return true;"></a>';
					    htmlString2 +='<a onClick="onClickGetPhoto(\''+ arrayListInvoicesByCust[i].id_invoice + '\'); return true;" class="ui-btn ui-btn-icon-notext ui-icon-camera ui-corner-all"  data-ajax="false"></a>';
						htmlString2 +='</td></tr></table></li>';
						console.log("appliedAmount " + arrayListInvoicesByCust[i].appliedAmount + ", casted=" + NumberCast(arrayListInvoicesByCust[i].appliedAmount,2, 0.00)  )
						TotBalanceRem += NumberCast(arrayListInvoicesByCust[i].balanceRemaining,2, 0.00)*1;
						TotAmount += NumberCast(arrayListInvoicesByCust[i].appliedAmount,2, 0.00)*1;
						console.log("TotAmount =" + TotAmount  )
					}
					htmlString2 += '</ul>';
					htmlString2 += '<br/><table cellspacing="0" class="ui-block-a"><tr><td>Total Balance Remaining</td><td>Total Applied Amount</td></tr><tr><td>'+NumberCast(TotBalanceRem,2, 0.00)+'</td><td>'+NumberCast(TotAmount,2, 0.00)+'</td></tr></table>';
					$('#InvoiceList').html(htmlString2);
					$("#listInvoiceByCust").listview().listview("refresh");
					console.log("htmlString2=" + htmlString2);
					$(".linkDetail").click(goDetailInvoice);
			}
			
			function goDetail(event){
				var index =  event.currentTarget.id;
				logZoe("goDetail index: "+index)
				index = index.substring(index.indexOf("_")+1);
				selectedIndex = index;
				renderDetail(index);
			}
			
			function goDetailInvoice(event){
				var index =  event.currentTarget.id;
				logZoe("goDetail Invoice index: "+index)
				index = index.substring(index.indexOf("_")+1);
				selectedIndex2 = index;
			}			
			
			function goDetailCreditMemo(event){
				var index =  event.currentTarget.id;
				logZoe("goDetail Credit Memo index: "+index)
				index = index.substring(index.indexOf("_")+1);
				selectedIndex2 = index;
			}	
			
			var CustomerAddress='';
			var CustomerEmail='';
			var CustomerPhone='';

			function renderDetail(index){
				logZoe("renderDetail index=" + index);
				logZoe("renderDetail =" + JSON.stringify(listCustomers[index]));

				// Trae los datos del "registro" del servidor de QuickBooks
				$('#lblFullName').text(listCustomers[index].FullName);
				$('#lblOpenBalance1').text(listCustomers[index].openBalance);
				$('#lblOverdueBalance1').text(listCustomers[index].overdueBalance);
				
				$('#SalesRep').val(listCustomers[index].id_salesrep);
				$('#SalesRepName').val(window.localStorage.getItem("salesRepName"));
				$('#ListID').val(listCustomers[index].ListID);
				$('#IsActive').val(listCustomers[index].IsActive);
				$('#FullName').val(listCustomers[index].FullName);
				$('#openBalance').val(listCustomers[index].openBalance);
				$('#Name').val(listCustomers[index].name);
				$('#CompanyName').val(listCustomers[index].companyName);
				
				$('#Phone').val(listCustomers[index].workPhone);
				$('#Cell').val(listCustomers[index].cellPhone);
				$('#Fax').val(listCustomers[index].Fax);
				$('#Email').val(listCustomers[index].email);
				
				$('#billAddress1').val(listCustomers[index].billAddress1);
				$('#billAddress2').val(listCustomers[index].billAddress2);
				$('#billAddress3').val(listCustomers[index].billAddress3);
				$('#billCity').val(listCustomers[index].billAddresCity);
				$('#billState').val(listCustomers[index].billAddressState);
				$('#billZipCode').val(listCustomers[index].billAddresZipcode);
				$('#billCountry').val(listCustomers[index].billAddressCountry);
				
				$('#shipAddress1').val(listCustomers[index].shipAddress1);
				$('#shipAddress2').val(listCustomers[index].shipAddress2);
				$('#shipAddress3').val(listCustomers[index].shipAddress3);
				$('#shipCity').val(listCustomers[index].shipAddressCity);
				$('#shipState').val(listCustomers[index].shipAddressState);
				$('#shipZipCode').val(listCustomers[index].shipAddressZipcode);
				$('#shipCountry').val(listCustomers[index].shipAddressCountry);
				
				$('#openBalance').val(listCustomers[index].openBalance);
				$('#overdueBalance').val(listCustomers[index].overdueBalance);
					
				$('#Terms').val(listCustomers[index].id_term);
				$('#OtherDetails').val(listCustomers[index].otherDetails);
			
				$('#routeDay1').val(listCustomers[index].routeDay1);
				$('#routeDay2').val(listCustomers[index].routeDay2);	
				$('#routeDay3').val(listCustomers[index].routeDay3);
				$('#routeDay4').val(listCustomers[index].routeDay4);
				$('#routeDay5').val(listCustomers[index].routeDay5);
				$('#routeDay6').val(listCustomers[index].routeDay6);
				$('#routeDay7').val(listCustomers[index].routeDay7);
				$('#pricelevel_ListID').val(listCustomers[index].pricelevel_ListID);

				// Address for LocateAddress function
				CustomerAddress = listCustomers[index].billAddress2+', '+listCustomers[index].billAddresCity+', '+listCustomers[index].billAddressState;
				CustomerEmail = listCustomers[index].email;
				CustomerPhone = listCustomers[index].workPhone;
				
				termDAO.list(receiveTerms,errReceiveTerms);
				pricelevelDAO.list(receivePriceLevel,errPriceLevel);
				invoiceDAO.listByCustomer(listCustomers[index].ListID, receiveInvoices, errListInvoicesByCustomer);
				creditMemoDAO.listByCustomer(listCustomers[index].ListID, receiveCreditMemos, errListCreditMemosByCustomer);
			}
			
			function LocateAddress(){
				var MapAddress = 'http://maps.google.com/maps?q=';
				var AddressMap1 = MapAddress+CustomerAddress;
				$('#AddressMap').prop("href", AddressMap1);
			}
			
			function SendEmail(){
				var EmailP = 'mailto:';
				var Email1 = EmailP+CustomerEmail;
				$('#EmailAddress').prop("href", Email1);
			}
			
			function CallPhone(){
				var PhoneP = 'tel:';
				var Phone1 = PhoneP+CustomerPhone;
				$('#PhoneCall').prop("href", Phone1);
			}	
			
			function UpdateCustomer(){
				var customersVO = [];
								
				var customerVO = {
					id_salesrep:salesRepVO.id_salesrep,

					ListID:$('#ListID').val(),
					IsActive:$('#IsActive').val(),
					FullName:$('#FullName').val(),
					name:$('#Name').val(),
					companyName:$('#CompanyName').val(),

					workPhone:$('#Phone').val(),
					cellPhone:$('#Cell').val(),
					Fax:$('#Fax').val(),
					email:$('#Email').val(),

					billAddress1:$('#billAddress1').val(),
					billAddress2:$('#billAddress2').val(),
					billAddress3:$('#billAddress3').val(),
					billAddresCity:$('#billCity').val(),
					billAddressState:$('#billState').val(),
					billAddresZipcode:$('#billZipCode').val(),
					billAddressCountry:$('#billCountry').val(),

					shipAddress1:$('#shipAddress1').val(),
					shipAddress2:$('#shipAddress2').val(),
					shipAddress3:$('#shipAddress3').val(),
					shipAddressCity:$('#shipCity').val(),
					shipAddressState:$('#shipState').val(),
					shipAddressZipcode:$('#shipZipCode').val(),
					shipAddressCountry:$('#shipCountry').val(),
			
					openBalance:$('#openBalance').val(),
					overdueBalance:$('#overdueBalance').val(),

					id_term:$('#Terms').val(),
					otherDetails:$('#OtherDetails').val(),

					routeDay1:$('#routeDay1').val(),
					routeDay2:$('#routeDay2').val(),
					routeDay3:$('#routeDay3').val(),
					routeDay4:$('#routeDay4').val(),
					routeDay5:$('#routeDay5').val(),
					routeDay6:$('#routeDay6').val(),
					routeDay7:$('#routeDay7').val(),

					pricelevel_ListID:$('#pricelevel_ListID').val()
				};
				logZoe("ListID ========> " +$('#ListID').val());
				logZoe("FullName ========> " +$('#FullName').val());
				logZoe("Phone ========> " +$('#Phone').val());				
				logZoe("customerVO ========> " + JSON.stringify(customerVO));
				customersVO[0] = customerVO;
				customerDAO.store(customersVO, errCustomerUpdate, successCustomerUpdate, "local");
			}

			function successCustomerUpdate(){
					customerDAO.markToSync($('#ListID').val(), errCustomermarkToSync);
					alert("Customer was successful updated");
			}
			
			function errCustomerUpdate(err){
				alert("DB Error on update customers: "+JSON.stringify(err));
			}
			
			function errCustomermarkToSync(err){
				alert("DB Error on mark to Sync update customers: "+JSON.stringify(err));
			}
			
			// List Credit Memos by Customers
			var listCreditMemos = new Array();
			var selectedIndex3;			
			function receiveCreditMemos(arrayListCreditMemosByCust){
				listCreditMemos = arrayListCreditMemosByCust; // Copy local array to global array
				
				// Build customers' Credit memos by Customer, list with <ul> <li>
				var TotBalanceRemCM = 0.00;
				var TotAmountCM = 0.00;				
				var htmlString3 = '<ul id="ListCreditMemosByCust" data-role="listview" data-filter="true" data-filter-placeholder="Search Credit Memo...">';
				for(var i=0; i< arrayListCreditMemosByCust.length; i++) {
						htmlString3 += '<li data-filtertext="' + arrayListCreditMemosByCust[i].refNumber + '">'+
						'<table width="100%" border="0" style="border:none !important;"><tr><td width="80%" valign="top" style="border:none;">Credit Memo #' + arrayListCreditMemosByCust[i].refNumber +
						'<div>Amount: <span id="overdueBal">'+ifNull(arrayListCreditMemosByCust[i].appliedAmount,'')+'</span><br/>Balance Remaining:<span> '+ifNull(arrayListCreditMemosByCust[i].balanceRemaining,'')+'</span><br/>';
						htmlString3 +='</div></td><td width="20%" style:"border:none !important;" valign="top">';
						if (arrayListCreditMemosByCust[i].origin == 'local'){
							htmlString3 += '<a href="CreditMemo.html?id_creditMemo=' + arrayListCreditMemosByCust[i].id_creditMemo + '" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-notext ui-icon-edit"  data-ajax="false"></a>';
						}
						htmlString3 +='<a href="CreditMemoPreview.html?id_creditMemo=' + arrayListCreditMemosByCust[i].id_creditMemo +
						'" class="ui-btn ui-btn-icon-notext ui-icon-print ui-corner-all" data-ajax="false" onClick="onClickInvoicePreview(\''+ arrayListCreditMemosByCust[i].id_creditMemo + '\'); return true;"></a>' + 
						'</td></tr></table></li>';
						TotBalanceRemCM += NumberCast(arrayListCreditMemosByCust[i].balanceRemaining,2, 0.00)*1;
						TotAmountCM += NumberCast(arrayListCreditMemosByCust[i].appliedAmount,2, 0.00)*1;
					}
					htmlString3 += '</ul>';
					htmlString3 += '<br/><table cellspacing="0" class="ui-block-a"><tr><td>Total Balance Remaining</td><td>Total Applied Amount</td></tr><tr><td>'+NumberCast(TotBalanceRemCM,2, 0.00)+'</td><td>'+NumberCast(TotAmountCM,2, 0.00)+'</td></tr></table>';
					try{
						$('#CreditMemoList').html(htmlString3);
						$("#ListCreditMemosByCust").listview().listview("refresh");
						console.log("htmlString3=" + htmlString3);
					}catch(e){}
					$(".linkDetail").click(goDetailCreditMemo);
			}
						
			// Makes sure the code contained doesn't run until all the DOM elements have loaded
			function changeActivityList() {
				console.log("selectedIndex=" + selectedIndex);
				 $('.ActivitiesLists').hide();
					switch($('#selActivities').val()){
						case 'InvoiceCreditMemoList': $("#InvoiceList").show();
													  $("#CreditMemoList").show();
													  invoiceDAO.listByCustomer(listCustomers[selectedIndex].ListID, receiveInvoices, errListInvoicesByCustomer);
													  creditMemoDAO.listByCustomer(listCustomers[selectedIndex].ListID, receiveCreditMemos, errListCreditMemosByCustomer);
													  break;
						case 'InvoiceList'			: $("#InvoiceList").show(); 
													invoiceDAO.listByCustomer(listCustomers[selectedIndex].ListID, receiveInvoices, errListInvoicesByCustomer);
													  break;
						case 'CreditMemoList'		: $("#CreditMemoList").show(); 
													creditMemoDAO.listByCustomer(listCustomers[selectedIndex].ListID, receiveCreditMemos, errListCreditMemosByCustomer);
													  break;
					
					}
			}			
	
		</script>
		<style type="text/css">
		
.inlinetabs .ui-navbar {
    margin: 0px 2px;
	height: 54px;
	padding-left: 6px !important;
}

.inlinetabs .ui-tabs-nav > li {
    margin: 0 2px;
    width: auto;
    clear: none;
	height:15px;
}

.inlinetabs .ui-tabs-nav .ui-btn {
    border-bottom: none;
    border-top-left-radius: .6em;
    border-top-right-radius: .6em;
	width:55px;
}

.inlinetabs .ui-tabs-panel {
    background: #fff;
    border-radius: .6em;
    border: 1px solid #ddd;
}

.inlinetabs div {
   margin:2px 2px 2px 2px;
    outline:none;
}
			thead {color:black;}
			tbody {color:gray;}
			tfoot {
				color:#ff770f;
				font-weight:bolder;
			}
			table, th, td {
				border: 1px solid black;
			}
			.control-group {
				background-color:#FFFFFF;
				border-color:#000000;
				border-width:medium;
				border:thick;
				margin: 2px 2px 2px 2px;
			
				/*box-shadow: inset 2px 2px 1px 1px rgba(50, 50, 50, 0.75);*/
			}
			
			#lblFullName {color:black; font-weight:bolder; font-size:large;}
			#lblOpenBalance1 {color:black; font-weight:bolder; font-size:large;}
			#lblOpenBalance2 {color:grey; font-weight:bolder; font-size:medium;}
			#lblOverdueBalance1 {color:Crimson; font-weight:bolder; font-size:large;}
			#lblOverdueBalance2 {color:grey; font-weight:bolder; font-size:medium;}
			#Invoice {color:black; font-weight:bolder; font-size:medium;}
			#overdueBal {color:Crimson; font-weight:bolder; font-size:medium;}
			#OberdueBy {color:white; font-weight:bolder; background-color:Crimson; font-size:medium;}
			#AddedMonthsAgo {color:grey; font-size:medium;}
		</style> 
	</head>

	<body>

        <!-- CUSTOMERS LIST (ALPHABETIC BY NAME AND OVERDUE BALANCE IN RED) -->
		<div data-role="page" id="Customers" data-theme="a" data-title="Customers">
        	<span id="customerType"></span>
			<div data-role="content" id="CustomersList">
            <ul id="custList" data-role="listview" data-filter="true" data-filter-placeholder="Search customers..." data-inset="true">
            
                </ul>
			</div>
			<!-- divs de header, menu y footer-->
			<div data-role="header" data-position="fixed" data-id="theheader" class="app-header"></div>
			<div data-role="panel" data-display="overlay" data-position="left" id="menu" class="app-menu"></div>
			<div data-role="footer" data-position="fixed" data-id="thefooter" class="app-footer"></div>
		<!-- fin divs -->
		</div> 

		<!-- BEGIN CUSTOMERS DETAILS-->
		<div data-role="page" id="CustomersDetails"  data-title="Customers Detail" data-theme="a">
			<div data-role="content" >
				<fieldset data-role="controlgroup" data-type="vertical" class="control-group">
                    <div class="ui-grid-a" style="height:70px">
                        <div class="ui-block-a" style="height:100%"> 
                            <div align="left">
                                <label id="lblFullName"></label>
                            </div>
                        </div>
                        <div class="ui-block-b" style="height:100%">            
                            <div align="right">
                                <label id="lblOpenBalance1"></label>
                                <label id="lblOpenBalance2">OPEN</label>
                            </div>
                        </div>  
                    </div>
                    <div class="ui-grid-a" style="height:80px">
                        <div class="ui-block-a" style="height:100%"> 
                            <div align="left">
                                <div class="ui-grid-b">
                                    <div class="ui-block-a">
                                        <a id="PhoneCall" href="#" class="ui-btn ui-btn-icon-notext ui-icon-phone ui-corner-all" onClick="CallPhone();"></a>
                                    </div>
                                    <div class="ui-block-b">
                                        <a id="EmailAddress" href="#" class="ui-btn ui-btn-icon-notext ui-icon-mail ui-corner-all" onClick="SendEmail();"></a> 
                                    </div>
                                    <div class="ui-block-c">
                                        <address>
											<a id="AddressMap" href="#" target="_blank" class="ui-btn ui-btn-icon-notext ui-corner-all ui-icon-location" onClick="LocateAddress();"></a>
                                        </address>
                                    </div>
                                </div><!-- /grid-b -->
                            </div>
                        </div>
                        <div class="ui-block-b" style="height:100%">            
                            <div align="right">
                                <label id="lblOverdueBalance1"></label>
                                <label id="lblOverdueBalance2">OVERDUE</label>
                            </div>
                        </div>
                    </div>
                </fieldset>
				<!-- CUSTOMERS DETAILS (LIST DETAILS, EDIT, ADD/ACTIVITIES) -->
                
                <div data-role="tabs" id="tabs" class="inlinetabs" data-theme="b">
                  <div data-role="navbar" class="ui-navbar">
                    <ul data-inset="true">
                      <li><a href="#TabCustomerDetails" data-ajax="false">Details</a></li>
                      <li><a href="#TabActivities" data-ajax="false">Activities</a></li>
                    </ul>
                  </div><div  id="TabCustomerDetails">
						<form id="formulario" >
							<!-- Relational Info --> 
							<fieldset data-role="controlgroup" data-type="vertical" class="control-group">
								<legend><h4>Sales Representant Info</h4></legend>
								<div data-role="fieldcontain">
									<div>
										<label for="ListID">Sales Representant:</label>
									</div>
									<input class="myFormsControl" type="text" data-theme="b" name="SalesRepName" id="SalesRepName" value="" readonly/>
									<input type="hidden" data-theme="b" name="SalesRep" id="SalesRep" value="" readonly/>
								</div>
							</fieldset>    
							<!-- Identification Info -->
							<fieldset data-role="controlgroup" data-type="vertical" class="control-group" style="padding:8px">
								<div data-role="fieldcontain">
									<div>
									<input type="hidden" data-theme="b" name="ListID" id="ListID" value=""/>
									<input type="hidden" data-theme="b" name="IsActive" id="IsActive" value=""/>
										<label for="FullName">Full Name:</label>
									</div>
									<input  class="myFormsControl" type="text" data-theme="b" name="FullName" id="FullName" value=""/>
								</div>
								<div data-role="fieldcontain">
									<div>
										<label for="Name">Name:</label>
									</div>
									<input type="text" data-theme="b" name="Name" id="Name" value=""  />
								</div>
								<div data-role="fieldcontain">
									<div>
										<label for="CompanyName">Company Name:</label>
									</div>
									<input type="text" data-theme="b" name="CompanyName" id="CompanyName" value=""  />
								</div>
							</fieldset> 
							<!-- Contact Info -->
							<fieldset data-role="controlgroup" data-type="vertical" class="control-group" style="padding:8px"> 
								<legend><h4>Contact Info</h4></legend>                       
								<div data-role="fieldcontain">
									<div>
										<label for="Phone">Phone:</label>
									</div>
									<input type="tel" data-theme="b" name="Phone" id="Phone" value=""  />              
								</div>
								<div data-role="fieldcontain">
									<div>
										<label for="Cell">Cell:</label>
									</div>
									<input type="tel" data-theme="b" name="Cell" id="Cell" value=""  />              
								</div>
								<div data-role="fieldcontain">
									<div>
										<label for="Fax">Fax:</label>
									</div>
									<input type="text" data-theme="b" name="Fax" id="Fax" value=""  />              
								</div>
								<div data-role="fieldcontain">
									<div>
										<label for="Email">Email:</label>
									</div>
									<input type="email" data-theme="b" name="Email" id="Email" value=""  />              
								</div>
							</fieldset>
							<!-- Billing Address -->
							<fieldset data-role="controlgroup" data-type="vertical" class="control-group" style="padding:8px">
								<legend><h4>Billing Address</h4></legend>
								<div data-role="fieldcontain">
									<div>
										<label for="billAddress1">Bill Address Line 1:</label>
									</div>
									<input type="text" data-theme="b" name="billAddress1" id="billAddress1" value=""  />
								</div>
								<div data-role="fieldcontain">
									<div>
										<label for="billAddress2">Bill Address Line 2:</label>
									</div>
									<input type="text" data-theme="b" name="billAddress2" id="billAddress2" value=""  />
								</div>
								<div data-role="fieldcontain">
									<div>
										<label for="billAddress3">Bill Address Line 3:</label>
									</div>
									<input type="text" data-theme="b" name="billAddress3" id="billAddress3" value=""  />
								</div>
								
								<div data-role="fieldcontain">
									<div>
										<label for="billCity">City:</label>
									</div>
									<input type="text" data-theme="b" name="billCity" id="billCity" value=""  />
								</div>
								<div data-role="fieldcontain">
									<div>
										<label for="billState">State:</label>
									</div>
									<input type="text" data-theme="b" name="billState" id="billState" value=""  />
								</div>
								<div class="ui-grid-a" style="height:95px">
									<div class="ui-block-a" style="height:100%"> 
										<div data-role="fieldcontain">
											<div>
												<label for="billZipCode">Zip Code:</label>
											</div>
											<input type="number" data-theme="b" name="billZipCode" id="billZipCode" value=""  />
										</div>                    
									</div>
									<div class="ui-block-b" style="height:100%">            
                                        <div data-role="fieldcontain">
                                            <div>
                                                <label for="billCountry">Country:</label>
                                            </div>
                                            <input type="text" data-theme="b" name="billCountry" id="billCountry" value=""  />
                                        </div>                      
									</div>
								</div>
                                <div data-role="fieldcontain">
                                    <div>
                                        <label for="copyBillToShip">Copy billing to shipping</label>
                                    </div>
                                    <input type="checkbox" data-theme="b" name="copyBillToShip" id="copyBillToShip" value=""  onChange="BillToShipCopy();"/>
                                </div>
							</fieldset>
							<!-- Shiping Address -->
							<fieldset data-role="controlgroup" data-type="vertical" class="control-group" style="padding:8px">
								<legend><h4>Shiping Address</h4></legend>
								<div data-role="fieldcontain">
									<div>
										<label for="shipAddress1">Ship Address Line 1:</label>
									</div>
									<input type="text" data-theme="b" name="shipAddress1" id="shipAddress1" value=""  />
								</div>
								<div data-role="fieldcontain">
									<div>
										<label for="shipAddress2">Ship Address Line 2:</label>
									</div>
									<input type="text" data-theme="b" name="shipAddress2" id="shipAddress2" value=""  />
								</div>
								<div data-role="fieldcontain">
									<div>
										<label for="shipAddress3">Ship Address Line 3:</label>
									</div>
									<input type="text" data-theme="b" name="shipAddress3" id="shipAddress3" value=""  />
								</div>
								<div data-role="fieldcontain">
									<div>
										<label for="shipCity">Ship City:</label>
									</div>
									<input type="text" data-theme="b" name="shipCity" id="shipCity" value=""  />
								</div>
								<div data-role="fieldcontain">
									<div>
										<label for="shipState">Ship State:</label>
									</div>
									<input type="text" data-theme="b" name="shipState" id="shipState" value=""  />
								</div>
								<div class="ui-grid-a" style="height:95px">
									<div class="ui-block-a" style="height:100%"> 
										<div data-role="fieldcontain">
											<div>
												<label for="shipZipCode">Ship Zip Code:</label>
											</div>
											<input type="number" data-theme="b" name="shipZipCode" id="shipZipCode" value=""  />
										</div>
									</div>
									<div class="ui-block-b" style="height:100%">            
										<div data-role="fieldcontain">
											<div>
												<label for="shipCountry">Ship Country:</label>
											</div>
											<input type="text" data-theme="b" name="shipCountry" id="shipCountry" value=""  />
										</div>
									</div>  
								</div>
							</fieldset> 
							<!-- Balance Info -->
							<fieldset data-role="controlgroup" data-type="vertical" class="control-group" style="padding:8px">
								<legend><h4>Balance Info</h4></legend>
								<div class="ui-grid-a" style="height:95px">
									<div class="ui-block-a" style="height:100%"> 
										<div data-role="fieldcontain">
											<div>
												<label for="openBalance">Open:</label>
											</div>
											<input type="text" data-theme="b" name="openBalance" id="openBalance" value=""  onClick="overdueBalanceRed();"/>
										</div>                    
									</div>
									<div class="ui-block-b" style="height:100%">            
										<div data-role="fieldcontain">
											<div>
												<label for="overdueBalance">Overdue:</label>
											</div>
											<input type="text" data-theme="b" name="overdueBalance" id="overdueBalance" value=""  />
										</div>                      
									</div>  
								</div>
							</fieldset>           
							<!-- Terms Info --> 
							<fieldset data-role="controlgroup" data-type="vertical" class="control-group" style="padding:8px">
								<div data-role="fieldcontain" id="CustomerTerms">
								  <div>
									<label for="Terms" class="select">Terms:</label>
								  </div>
								  <select  class="myFormsControl"  name="Terms" id="Terms" data-theme="a">
									<option value="option1">Choose a term</option>
								  </select>
								</div>
							</fieldset> 
							<!-- Other Info -->                       
							<fieldset data-role="controlgroup" data-type="vertical" class="control-group" style="padding:8px">
								<div data-role="fieldcontain">
									<div>
										<label for="OtherDetails">Other Details:</label>
									</div>
									<input type="text" data-theme="b" name="OtherDetails" id="OtherDetails" value=""  />
								</div> 
							</fieldset> 

							<!-- Route days info -->
							<fieldset data-role="controlgroup" data-type="vertical" class="control-group" style="padding:8px">
								<legend><h4>Route Info</h4></legend>

                                    <div data-role="fieldcontain">
                                        <div>
                                            <label for="routeDay1">Sunday</label>
                                        </div>
                                        <input  class="myFormsControl"  type="checkbox" data-theme="b" name="routeDay1" id="routeDay1" value=""  />
                                    </div>
    
                                    <div data-role="fieldcontain">
                                        <div>
                                            <label for="routeDay2">Monday</label>
                                        </div>
                                        <input class="myFormsControl"  type="checkbox" data-theme="b" name="routeDay2" id="routeDay2" value=""  />
                                    </div>                
                                    <div data-role="fieldcontain">
                                        <div>
                                            <label for="routeDay3">Tuesday</label>
                                        </div>
                                        <input class="myFormsControl"  type="checkbox" data-theme="b" name="routeDay3" id="routeDay3" value=""  />
                                    </div>                
                                    <div data-role="fieldcontain">
                                        <div>
                                            <label for="routeDay4">Wednesday</label>
                                        </div>
                                        <input  class="myFormsControl" type="checkbox" data-theme="b" name="routeDay4" id="routeDay4" value=""  />
                                    </div>                
                                    <div data-role="fieldcontain">
                                        <div>
                                            <label for="routeDay5">Thursday</label>
                                        </div>
                                        <input  class="myFormsControl" type="checkbox" data-theme="b" name="routeDay5" id="routeDay5" value=""  />
                                    </div>                
                                    <div data-role="fieldcontain">
                                        <div>
                                            <label for="routeDay6">Friday</label>
                                        </div>
                                        <input class="myFormsControl"  type="checkbox" data-theme="b" name="routeDay6" id="routeDay6" value=""  />
                                    </div>                
                                    <div data-role="fieldcontain">
                                        <div>
                                            <label for="routeDay7">Saturday</label>
                                        </div>
                                        <input class="myFormsControl"  type="checkbox" data-theme="b" name="routeDay7" id="routeDay7" value=""  />
                                    </div> 
							</fieldset>
							<!-- Price Level Info -->                       
							<fieldset data-role="controlgroup" data-type="vertical" class="control-group" style="padding:8px">
								<div data-role="fieldcontain" id="CustomerPriceLevel">
								  <div>
									<label for="priceLevel" class="select">Price Level:</label>
								  </div>
								  <select name="priceLevel" id="priceLevel" data-theme="a">
									<option value="option1">Choose a price level</option>
								  </select> 
								</div>
							</fieldset>                                                         
							<!-- Done and Cancel Buttons -->
                            <fieldset data-role="controlgroup" data-type="vertical" class="control-group" style="padding:8px;">
                                <div class="ui-grid-a" style="height:45px">
                                    <div class="ui-block-a ui-btn ui-corner-all ui-shadow" style="height:100%"><button id="cancel" data-add-back-btn="true" data-theme="b">Cancel</button></div>
                                    <div class="ui-block-b ui-btn ui-corner-all ui-shadow" style="height:100%"><button id="btnUpdateCustomer"  onClick="UpdateCustomer(); return false;" data-theme="c">Done</button></div>	
                                </div>
                            </fieldset>
						</form>		

					</div>
					<!-- ACTIVITIES CONTENT - TAB 2 -->
					<div id="TabActivities" style="width:100%">
						<fieldset data-role="controlgroup" data-type="vertical" class="control-group">
							<div data-role="fieldcontain">
							  <select name="selActivities" id="selActivities" data-theme="a" onChange="changeActivityList()">
                              	<option value="" selected="selected">Select activity...</option>
								<option value="InvoiceCreditMemoList">All Activities</option>
								<option value="InvoiceList">Invoices last month</option>
								<option value="CreditMemoList">Credit memos last month</option>
							  </select>
							</div>
                            <!-- BEGIN Invoices List and overdue -->
                            <div data-role="content" id="InvoiceList" class="ActivitiesLists" style="display:none; padding-left:2px !important; padding-right:2px !important">
                                <!-- Injection-->
                            </div>
                            <!-- END Invoices List and overdue -->	
                            <!-- BEGIN Credit Memo List -->
                            <div data-role="content" id="CreditMemoList" class="ActivitiesLists" style="display:none;">
                                <!-- Injection-->
                            </div>
                            <!-- END Credit Memo List --> 						
					</fieldset> 
					</div>
				</div>				

			</div>

			<!-- divs de header, menu y footer-->
			<div data-role="header" data-position="fixed" data-id="theheader2" class="app-header"></div>
			<div data-role="panel" data-display="overlay" data-position="left" id="menu2" class="app-menu"></div>
			<div data-role="footer" data-position="fixed" id="thefooter2" class="app-footer"></div>
			<!-- fin divs -->    
		</div>
		<!-- END CUSTOMERS DETAILS--> 
	</body>
</html>

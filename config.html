<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Config</title>
        <!-- librerias de estilos y js jquery y zoe -->
  <link rel="stylesheet" href="css/themes/zoe.min.css" />
  <link rel="stylesheet" href="css/themes/jquery.mobile.icons.min.css" />
  <link rel="stylesheet" href="js/jquery-mobile/jquery.mobile.structure-1.4.5.min.css" />
  <link rel="stylesheet" href="js/zoe/jquery.mobile.simpledialog.min.css" />

  <!--link rel="stylesheet" href="js/jquery-mobile/jquery.mobile-1.4.5.min.css" /-->  
<script src="js/jquery-mobile/jquery-2.1.4.js" type="text/javascript"></script>
<script src="js/jquery-mobile/jquery.mobile-1.4.5.min.js" type="text/javascript"></script>
<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="phonegap.js"></script>
<script src="js/zoe/zoe.js" type="text/javascript"></script>
<script src="js/zoe/zoesync.js" type="text/javascript"></script>
<script src="js/zoe/salesRepDAO.js" type="text/javascript"></script>
<script src="js/zoe/paymentMethodDAO.js" type="text/javascript"></script>
<script src="js/zoe/customerDAO.js" type="text/javascript"></script>
<script src="js/zoe/vendorDAO.js" type="text/javascript"></script>
<script src="js/zoe/invoiceDAO.js" type="text/javascript"></script>
<script src="js/zoe/inventorySiteDAO.js" type="text/javascript"></script>
<script src="js/zoe/creditMemoDAO.js" type="text/javascript"></script>
<script src="js/zoe/customerMsgDAO.js" type="text/javascript"></script>
<script src="js/zoe/termDAO.js" type="text/javascript"></script>
<script src="js/zoe/taxDAO.js" type="text/javascript"></script>
<script src="js/zoe/inventoryDAO.js" type="text/javascript"></script>
<script src="js/zoe/pricelevelDAO.js" type="text/javascript"></script>
<script src="js/zoe/classDAO.js" type="text/javascript"></script>
<script src="js/sha256.js" type="text/javascript"></script>
<!-- fin librerias -->

<script>
		$(document).bind("pagebeforecreate", function(event) {
			console.log("en pagebeforecreate config.html salesRepName=" + window.localStorage.getItem(
	"salesRepName"));
			if (event.target && event.target.id && event.target.id.toUpperCase().indexOf("CONFIG")==-1){
				return;
			}
			initAnyPage(event.target);
			initThisPage(event);
		});

	function initThisPage(event){
			$('#salesRepName').val(window.localStorage.getItem("salesRepName"));	
			if (!window.localStorage.getItem("syncURL")){
				window.localStorage.setItem("syncURL","http://24.234.187.107:54320/SyncService");
			}
			$('#syncURL').val(window.localStorage.getItem("syncURL"));	
			$('#submitConfig').click(submitFormConfig);	
			$('#createDB').click(submitCreateDatabase);	
			fillNeedToSync();
			logZoe("config.html listo pagebeforecreate");
		}
		
	function submitCreateDatabase(){
		console.log("create dabatase call");
		createDatabase();
	}

	function submitFormConfig(form) {
		window.localStorage.setItem("salesRepName", $('#salesRepName').val());
		window.localStorage.setItem("syncURL",$('#syncURL').val());
		logZoe("config localStorage salesRepName=" + window.localStorage.getItem("salesRepName"));
		return false;
	}
	
	function fillNeedToSync(){
		console.log("fillNeedToSync");
		if (!needToSync) {
			setTimeout("fillNeedToSync()",100);
			return;
		}
		$('#syncUpSelect').empty();
		$('#syncUpSelect').append('<option value="choose-one" data-placeholder="true">Choose what to upload</option>');
		for (var i in needToSync) {	
			var option= '<option value="syncUp' + needToSync[i].entity +'">'+ needToSync[i].entity + ' [' + needToSync[i].total +']</option>';
			console.log(option);
			$('#syncUpSelect').append(option);
		}
		$('#syncUpSelect').trigger("chosen:updated");
		$('#syncUpSelect').selectmenu('refresh');
	}
	
	var wasSelectedAllSyncDown=false;
	function onChangeSyncDownSelect(){
		var	selectedValues = $("#syncDownSelect").val();
		var newValue;
		var toggle = false;
		if (selectedValues.indexOf("all")>-1 && !wasSelectedAllSyncDown){
			newValue = true;
			toggle = true;
			wasSelectedAllSyncDown = true;
		}else if (selectedValues.indexOf("all")==-1 && wasSelectedAllSyncDown){
			newValue = false;
			toggle = true;
			wasSelectedAllSyncDown = false;
		}
		console.log("onChangeSyncDownSelect toggle=" + toggle);
		console.log("onChangeSyncDownSelect values=" + selectedValues);
		if (toggle){
			$('#syncDownSelect').find("option").each(function(){
			   if($(this).val()!="all" && $(this).val().indexOf("hoose")==-1){
				   $("#syncDownSelect option[value='" + $(this).val() + "']").prop("selected",newValue);
				   $("#syncDownSelect option[value='" + $(this).val() + "']").prop("disabled",newValue);
			   }
			});
			$("#syncDownSelect").selectmenu("refresh");
			console.log("syncDownSelect.val="+$("#syncDownSelect").val());
		}
	}
	
	var whatToUpload = new Array();
	var currentUp = 0;
	var messagePopup = "";
	function syncUp(){
		if (itemsToSync==0){
			alert("Nothing to do");
	        return;
		}
		whatToUpload = $("#syncUpSelect").val();
		messagePopup = "";
		console.log("whatToUpload=" + whatToUpload);
		currentUp = -1;
		$("#synchDialog").popup("open"); 
		upNext();
	}

	function upNext(){
		currentUp += 1;
		console.log("upNext currentUp=" + currentUp);
		if (currentUp<whatToUpload.length){
			console.log("uploading " +  whatToUpload[currentUp]);
			messagePopup += "<br><B>" + whatToUpload[currentUp] + "...</B>";
			$("#currentTask").html(messagePopup);
			if (whatToUpload[currentUp] == "syncUpInvoices" ){
				syncUpInvoices();
			}else if (whatToUpload[currentUp] == "syncUpCreditMemos" ){
				syncUpCreditMemos();
			}else if (whatToUpload[currentUp] == "syncUpCustomers" ){
				syncUpCustomers();
			}else{
				upNext();
			}
		}else{
			console.log("Synch upload finish!");
			var html = $("#currentTask").html();
			messagePopup +=  "<br><b>Finish</b>";
			$("#currentTask").html(messagePopup);
			$("#btnSynchDialog").html("Accept");
			
//			setTimeout(function(){ $("#synchDialog").popup("close"); }, 5000);
		}
	}

	var whatToDownload = new Array();
	var currentDown = 0;
	function syncDown(){
		if (itemsToSync>0){
			var willcontinue = confirm("Items to sync found (" + itemsToSync + ").  Are you really sure to download server data?"  + itemsToSync);
			if (!willcontinue)
		        return;
		}
		var i = 0;
		if ($("#syncDownSelect").val().indexOf("all")>-1){
			$('#syncDownSelect').find("option").each(function(){
			   if($(this).val()!="all" && $(this).val().indexOf("hoose")==-1){
				   whatToDownload[i++] = $(this).val();
			   }
			});
		}else{
			whatToDownload = $("#syncDownSelect").val();
		}
		console.log("whatToDownload=" + whatToDownload);
		currentDown = -1;
		 $("#synchDialog").popup("open"); 
		 console.log("synchDialog open");
		downNext();
	}

	function downNext(){
		currentDown += 1;
		if (currentDown<whatToDownload.length){
			if (whatToDownload[currentDown] == "all" || whatToDownload[currentDown].indexOf("hoose")>-1){
				downNext();
				return;
			}
			console.log("downloading " +  whatToDownload[currentDown]);
			messagePopup += whatToDownload[currentDown] + "...<br>";
			$("#currentTask").html(messagePopup);
			if (whatToDownload[currentDown] == "syncDownSalesRep" ){
				syncSalesRep();
			}else if (whatToDownload[currentDown] == "syncTaxes" ){
				syncTaxes();
			}else if (whatToDownload[currentDown] == "syncTerms" ){
				syncTerms();
			}else if (whatToDownload[currentDown] == "syncClasses" ){
				syncClasses();
			}else if (whatToDownload[currentDown] == "syncPaymentMethods" ){
				syncPaymentMethods();
			}else if (whatToDownload[currentDown] == "syncDownInventory" ){
				syncInventoryItems();
			}else if (whatToDownload[currentDown] == "syncDownInventorySite" ){
				syncInventorySite();
			}else if (whatToDownload[currentDown] == "syncDownPricelevel" ){
				syncPricelevel();
			}else if (whatToDownload[currentDown] == "syncDownInvoices" ){
				syncInvoices();
			}else if (whatToDownload[currentDown] == "syncDownCreditMemos" ){
				syncCreditMemos();
			}else if (whatToDownload[currentDown] == "syncDownCustomers" ){
				whatToDownload[whatToDownload.length]="syncDownVendors";
				syncCustomers();
			}else if (whatToDownload[currentDown] == "syncCustomerMsgs" ){
				syncCustomerMsgs();
			}else if (whatToDownload[currentDown] == "syncDownVendors" ){
				syncDownVendors();
			}
			
		}else{
			console.log("Synch down finish!");
			$("#currentTask").html("Finish!!");
			setTimeout(function(){ $("#synchDialog").popup("close"); }, 3000);
			; 
		}
	}

	function cancelSync () {
		$("#synchDialog").popup("close");
		whatToDownload = new Array();
		currentDown = -1;
		synchronizing = false;
		whatToUpload = new Array();
		currentUp = -1;
		window.location ="config.html";
	}


//SYNCHRONIZATION Employee and Salesrep	
	function syncSalesRep(form){
		console.log("entre a syncSalesRep");
		var mensaje = 	
		'		<EmployeeQueryRq requestID="c1"><OwnerID>0</OwnerID></EmployeeQueryRq>';
		var cache = "employee";
		var xpathExp = '//EmployeeRet[translate(Name,"abcdefghjiklmnopqrstuvwxyz","ABCDEFGHJIKLMNOPQRSTUVWXYZ")="' + window.localStorage.getItem("salesRepName").toUpperCase() + '"]';				
		consumeWS(mensaje, "JSON", receiveMessageEmployee,cache, xpathExp);
		
		return false;
	}
	

	var salesRepVO;
	function receiveMessageEmployee(message){
		var employee = message.EmployeeQueryRs.EmployeeRet;
		var password = "";
		var roles = "user";
		console.log("receiveMessageEmployee employee.DataExtRet=" + employee.DataExtRet);
		console.log("receiveMessageEmployee employee.DataExtRet.length=" + employee.DataExtRet);
		if (employee.DataExtRet && employee.DataExtRet.length>0){
			for (var j = 0; j< employee.DataExtRet.length; j++){
				console.log("employee.DataExtRet[j].DataExtName=" + employee.DataExtRet[j].DataExtName);
				if ("PASSWORD" == employee.DataExtRet[j].DataExtName.toUpperCase()){
					password = employee.DataExtRet[j].DataExtValue;
				}else if ("ZOEROLE" == employee.DataExtRet[j].DataExtName.toUpperCase()){
					roles = employee.DataExtRet[j].DataExtValue;
				}
			}
		}else if (employee.DataExtRet && employee.DataExtRet.DataExtName.toUpperCase()=="PASSWORD"){
			password = employee.DataExtRet.DataExtValue;
		}else if (employee.DataExtRet && "ZOEROLE" == employee.DataExtRet.DataExtName.toUpperCase()){
			roles = employee.DataExtRet[j].DataExtValue;
		}
		password = password+"";
		console.log("password=" + password);
		salesRepVO = {id_employee:employee.ListID,
			name:employee.Name, 
			password:CryptoJS.SHA256(password), 
			roles: roles,
			isActive:employee.IsActive, 
			syncTime:Date.now(), Initial:""};
			
		var mensajeSalesRep = '<SalesRepQueryRq requestID="c1"></SalesRepQueryRq>';
		var cache = "salesrep";
		var xpathExp = '//SalesRepRet[translate(SalesRepEntityRef/FullName,"abcdefghjiklmnopqrstuvwxyz","ABCDEFGHJIKLMNOPQRSTUVWXYZ")="' + window.localStorage.getItem('salesRepName').toUpperCase() + '"]';

		
		consumeWS(mensajeSalesRep, "JSON", receiveMessageSalesRep,cache, xpathExp);
			
	}
	function successSyncSalesRep(){
		downNext();
	}
	
	function errSalesRepSync(err){
		alert("DB Error synch salesrep: "+JSON.stringify(err));
	}
	

	function receiveMessageSalesRep(message){
		var salesRep = message.SalesRepQueryRs.SalesRepRet;
		logZoe("receiveMessageSalesRep salesRep=" + JSON.stringify(salesRep));
		logZoe("receiveMessageSalesRep salesRep.Initial=" + JSON.stringify(salesRep.Initial));
		salesRepVO.id_salesRep = salesRep.ListID;
		salesRepVO.Initial = salesRep.Initial+ "";
		logZoe("receiveMessageSalesRep salesRepVO=" + JSON.stringify(salesRepVO));
			
		salesRepDAO.store(salesRepVO, errSalesRepSync, successSyncSalesRep);
	}
	
//SYNCHRONIZATION Customers	
	function syncCustomers(form){
		console.log("entre a syncCustomers");
		salesRepDAO.getByName(window.localStorage.getItem("salesRepName"), function(salesrepVO){
		logZoe("en syncCustomers salesrepVO = " + JSON.stringify(salesrepVO));
		var mensaje = 	
		'<CustomerQueryRq  requestID="customer1"></CustomerQueryRq>';
		var cache="customer";
		var xpathExp = '//CustomerRet[SalesRepRef/FullName="'+ salesrepVO.initial + '"]';
		
		consumeWS(mensaje, "JSON", receiveCustomersMessage, cache, xpathExp);
		});
		return false;
	}

	var vendorNames = new Array();
	function receiveCustomersMessage(message){
		var customers = message.CustomerQueryRs.CustomerRet;
		var i;
		var customersVO = [];
		for (i=0;i<customers.length;i++){
			var customer = customers[i];
			customerVO = convertCustomerQB(customer);
			logZoe("customerVO=" + JSON.stringify(customerVO));
			customersVO[i] = customerVO;
		}
			
		customerDAO.deleteAll(errCustomerInsert);
		customerDAO.store(customersVO, errCustomerInsert, successCustomerInsert,'remote');
		
	}
	
	function convertCustomerQB(customer){
			console.log("customer=" + JSON.stringify(customer));
			logZoe("customer.TermsRef=" + JSON.stringify(customer.TermsRef));
			if (customer.TermsRef){
				logZoe("customer.TermsRef.ListID=" + JSON.stringify(customer.TermsRef));					
			}
			var routeDay = "";
			var vendorName = null;

			console.log("customer.DataExtRet:" + JSON.stringify(customer.DataExtRet));
			if (customer.DataExtRet && customer.DataExtRet.length>0){
				for (var j = 0; j< customer.DataExtRet.length; j++){
					console.log("customer].DataExtRet[j].DataExtName=" + customer.DataExtRet[j].DataExtName);
					if ("ROUTEDAY" == customer.DataExtRet[j].DataExtName.toUpperCase()){
						routeDay = customer.DataExtRet[j].DataExtValue;
						console.log("routeday encontrado asi queda routeDay=" + routeDay);
					}
					if ("PAY TO" == customer.DataExtRet[j].DataExtName.toUpperCase()){
						vendorName = customer.DataExtRet[j].DataExtValue.toUpperCase();
						if (vendorNames.indexOf(vendorName)==-1){
							vendorNames[vendorNames.length]=vendorName;
						}
					}
				}
			}else if (customer.DataExtRet && customer.DataExtRet.DataExtName.toUpperCase()=="ROUTEDAY"){
						routeDay = customer.DataExtRet.DataExtValue;
						console.log("routeday encontrado asi queda routeDay=" + routeDay);
			}else if (customer.DataExtRet && customer.DataExtRet.DataExtName.toUpperCase()=="PAY TO"){
						vendorName = customer.DataExtRet.DataExtValue.toUpperCase();
						if (vendorNames.indexOf(vendorName)==-1){
							vendorNames[vendorNames.length]=vendorName;
						}
			}
			routeDay = routeDay.toUpperCase();
			logZoe("routeday=" + routeDay);
			var customerVO = {ListID:customer.ListID,
			editSequence:customer.EditSequence+	"",
			FullName:customer.FullName,
			IsActive:customer.IsActive==true?1:0,
			billAddress1:customer.BillAddress?customer.BillAddress.Addr1:null,
			billAddress2:customer.BillAddress?customer.BillAddress.Addr2:null,
			billAddress3:customer.BillAddress?customer.BillAddress.Addr3:null,
			billAddresZipcode:customer.BillAddress?customer.BillAddress.PostalCode+"":null,
			billAddresCity:customer.BillAddress?customer.BillAddress.City:null,
			billAddressState:customer.BillAddress?customer.BillAddress.State:null,
			billAddressCountry:customer.BillAddress?customer.BillAddress.Country:null,
			shipAddress1:customer.ShipAddress?customer.ShipAddress.Addr1:null,
			shipAddress2:customer.ShipAddress?customer.ShipAddress.Addr2:null,
			shipAddress3:customer.ShipAddress?customer.ShipAddress.Addr3:null,
			shipAddressZipcode:customer.ShipAddress?customer.ShipAddress.PostalCode+"":null,
			shipAddressCity:customer.ShipAddress?customer.ShipAddress.City:null,
			shipAddressState:customer.ShipAddress?customer.ShipAddress.State:null,
			shipAddressCountry:customer.ShipAddress?customer.ShipAddress.Country:null,
			openBalance:customer.Balance,
			overdueBalance:customer.TotalBalance,
			workPhone:customer.Phone,
			cellPhone:customer.AltPhone,
			email:customer.Email,
			Fax:customer.Fax,
			id_salesrep:customer.SalesRepRef?customer.SalesRepRef.ListID:null,
			routeDay1:routeDay.indexOf("SUN")>-1||routeDay.indexOf("ALL")>-1?1:0,
			routeDay2:routeDay.indexOf("MON")>-1||routeDay.indexOf("ALL")>-1?1:0,
			routeDay3:routeDay.indexOf("TUE")>-1||routeDay.indexOf("ALL")>-1?1:0,
			routeDay4:routeDay.indexOf("WED")>-1||routeDay.indexOf("ALL")>-1?1:0,
			routeDay5:routeDay.indexOf("THU")>-1||routeDay.indexOf("ALL")>-1?1:0,
			routeDay6:routeDay.indexOf("FRI")>-1||routeDay.indexOf("ALL")>-1?1:0,
			routeDay7:routeDay.indexOf("SAT")>-1||routeDay.indexOf("ALL")>-1?1:0,
			name:customer.Name,
			companyName:customer.CompanyName,
			id_term:customer.TermsRef?customer.TermsRef.ListID:null,
			pricelevel_ListID:customer.PriceLevelRef?customer.PriceLevelRef.ListID:null,
			vendor_ListID:vendorName,
			origin:"remote"
			};
			return customerVO;

	}


	function successCustomerInsert(){
		downNext();
	}
	
	function errCustomerInsert(err){
		alert("DB Error synch customers: "+JSON.stringify(err));
	}

//SYNCHRONIZATION Invoices	
	function syncInvoices(form){
		console.log("entre a syncInvoices");
		salesRepDAO.getByName(window.localStorage.getItem("salesRepName"), function(salesrepVO){
		logZoe("en syncInvoices salesrepVO = " + JSON.stringify(salesrepVO));
		var mensaje = 	
		'<InvoiceQueryRq requestID="invoice"></InvoiceQueryRq>';
		var cache="invoice";
		var xpathExp = '//InvoiceRet[SalesRepRef/ListID="'+ salesrepVO.id_salesrep + '"]';
		
		consumeWS(mensaje, "JSON", receiveInvoicesMessage, cache, xpathExp);
		});
		return false;
	}

	var invoicesVO = [];
	function receiveInvoicesMessage(message){
		if (!message || !message.InvoiceQueryRs || !message.InvoiceQueryRs.InvoiceRet){
			return;
		}
		var invoices = message.InvoiceQueryRs.InvoiceRet;
		var i;
		invoicesVO = [];
		for (i=0;invoices && i<invoices.length;i++){
			var invoice = invoices[i];
			
			var invoiceVO = convertInvoiceFromQB(invoice);
			invoiceVO.origin = "remote";
			invoicesVO[i] = invoiceVO;
		}
		invoiceDAO.deleteAll(errCustomerInsert,storeInvoices);
				
	}
	
	function storeInvoices(){
		invoiceDAO.store(invoicesVO, errInvoiceInsert, successInvoiceInsert);
	}
	
	function convertInvoiceFromQB(invoice){
			logZoe("invoice=" + JSON.stringify(invoice));
			logZoe("invoice.TermsRef=" + JSON.stringify(invoice.TermsRef));
			if (invoice.TermsRef)
				logZoe("invoice.TermsRef.ListID=" + JSON.stringify(invoice.TermsRef.ListID));
			
			var invoiceVO = {
				id_invoice:invoice.TxnID,
				ListID : invoice.CustomerRef.ListID,
				po_number : invoice.PONumber,
				dueDate : invoice.DueDate,
				appliedAmount : invoice.AppliedAmount,
				txnDate: invoice.TxnDate,
				balanceRemaining : invoice.BalanceRemaining,
				billAddress_addr1 : invoice.BillAddress?invoice.BillAddress.Addr1:null,
				billAddress_addr2 :invoice.BillAddress?invoice.BillAddress.Addr2:null,
				billAddress_addr3 : invoice.BillAddress?invoice.BillAddress.Addr3:null,
				billAddress_city : invoice.BillAddress?invoice.BillAddress.City:null,
				billAddress_state : invoice.BillAddress?invoice.BillAddress.State:null,
				billAddress_postalcode : invoice.BillAddress?invoice.BillAddress.PostalCode:null,
				shipAddress_addr1 : invoice.BillAddress?invoice.BillAddress.addr1:null,
				shipAddress_addr2 : invoice.BillAddress?invoice.BillAddress.addr2:null,
				shipAddress_addr3 : invoice.BillAddress?invoice.BillAddress.addr3:null,
				shipAddress_city : invoice.BillAddress?invoice.BillAddress.City:null,
				shipAddress_state : invoice.BillAddress?invoice.BillAddress.State:null,
				shipAddress_postalcode : invoice.BillAddress?invoice.BillAddress.PostalCode:null,
				isPaid : invoice.IsPaid=="true"?1:0,
				isPending : invoice.IsPending=="true"?1:0,
				refNumber : invoice.RefNumber,
				TaxPercentage : invoice.SalesTaxPercentage,
				salesTaxTotal : invoice.SalesTaxTotal,
				shipDate : invoice.ShipDate,
				subtotal : invoice.Subtotal,
				customerMsg_ListID: invoice.CustomerMsgRef?invoice.CustomerMsgRef.ListID:null,
				id_salesrep:invoice.SalesRepRef?invoice.SalesRepRef.ListID:null,
				id_term: typeof invoice.TermsRef != "undefined"?invoice.TermsRef.ListID:null,
				items: new Array()
			}
			
			if (invoice.InvoiceLineRet){
				if (invoice.InvoiceLineRet.length){
					for (j=0;j<invoice.InvoiceLineRet.length;j++){
						var line = invoice.InvoiceLineRet[j];
						var itemVO = convertInvoiceLineToItem(invoiceVO,line);
						invoiceVO.items[j] = itemVO;
					}
				}else{
					var line = invoice.InvoiceLineRet;
					var itemVO = convertInvoiceLineToItem(invoiceVO,line);
					invoiceVO.items[0] = itemVO;
				}
					
			}
			return invoiceVO;
	}
	
	function convertInvoiceLineToItem(invoiceVO,line){
		var itemVO = {
		LineID:line.TxnLineID,
		id_invoice:invoiceVO.id_invoice,
		Inventory_ListID:line.ItemRef.ListID,
		Desc:line.Desc,
		Quantity:line.Quantity,
		Rate:line.Rate,
		Amount:line.Amount,
		SalesTax_ListID:line.SalesTaxCodeRef.ListID
		}
		return itemVO;

	}


	function successInvoiceInsert(){
		downNext();
	}
	
	function errInvoiceInsert(err){
		alert("DB Error synch invoices: "+JSON.stringify(err));
	}

	var extraDatas;
	function syncUpInvoices(form){
		console.log("entre a syncUpInvoices");
		var mensaje = "";
		extraDatas = new Array();
		invoiceDAO.listToUpload(function(results){
			for (var i in results){
				var rec = results[i];
				console.log("syncUpInvoices invoice["+ i + "]=" + JSON.stringify(rec));
				mensaje += '<InvoiceAddRq requestID="' + rec.refNumber+ '"><InvoiceAdd>'+
					'<CustomerRef><ListID>' + rec.ListID + '</ListID></CustomerRef>'+
					'<TxnDate>'+rec.shipDate+'</TxnDate>'+
					'<RefNumber>'+rec.refNumber+'</RefNumber>'+
					'<PONumber>'+rec.po_number+'</PONumber>'+
					'<TermsRef><ListID>'+rec.id_term+ '</ListID></TermsRef>'+
					'<DueDate>'+rec.dueDate+'</DueDate>'+
					'<SalesRepRef><ListID>' +rec.id_salesrep+'</ListID></SalesRepRef>'+
					'<Memo>' +rec.memo+'</Memo>';
					if (rec.customerMsg_ListID){
						mensaje+='<CustomerMsgRef><ListID>' +rec.customerMsg_ListID + '</ListID></CustomerMsgRef>';
					}
					if (rec.SalesTax_ListID){
						mensaje+='<CustomerSalesTaxCodeRef><ListID>' + rec.SalesTax_ListID + '</ListID></CustomerSalesTaxCodeRef>';
					}
				for (var j in rec.items){
					var item=rec.items[j];
					mensaje += '<InvoiceLineAdd><ItemRef><ListID>' + item.Inventory_ListID +'</ListID></ItemRef>';
					mensaje += '<Quantity>' + item.Quantity + '</Quantity>';
					mensaje += '<Rate>' + item.Rate + '</Rate>';
					if (item.InventorySite_ListID){
						mensaje += '<InventorySiteRef><ListID>' + item.InventorySite_ListID+ '</ListID></InventorySiteRef>';
					}
					mensaje += '</InvoiceLineAdd>';
				}
				mensaje += '</InvoiceAdd></InvoiceAddRq>';
				if (rec.photo!=null && rec.photo!=''){
					extraDatas[rec.refNumber] =  "{\"type\":\"invoicePhoto\",\"refNumber\":\"" + rec.refNumber + "\"" +
					",\"companyName\":\"" + rec.companyName +  "\"" +
					",\"date\":\"" + rec.txnDate + "\"" +
					",\"data\":\"" +rec.photo + "\"}";
				}
/*
				if (rec.signaturePNG!=null && rec.signaturePNG!=''){
					if (rec.photo!=null && rec.photo!=''){
						extraDatas[rec.refNumber] += ",";
					}else{
						extraDatas[rec.refNumber]="";
					}
					extraDatas[rec.refNumber] += "{\"type\":\"invoiceSignature\",\"refNumber\":\"" + rec.refNumber + "\"" +
					",\"companyName\":\"" + rec.companyName +  "\"" +
					",\"date\":\"" + rec.txnDate + "\"" +
					",\"data\":\"" +rec.signaturePNG + "\"},";
				}
				*/
			}
			
			console.log("syncUpInvoices mensaje=" +  mensaje)
			
			consumeWS(mensaje, "JSON", receiveSyncUpInvoicesMessage, null, null, null);
		});
		return false;
	}
	
	var InvoiceAddRs;
	var ListInvoiceAddRs;
	var currentInvoiceIndex;
	var currentInvoice;
	function receiveSyncUpInvoicesMessage(message){
		console.log('receiveSyncUpInvoicesMessage message=' + message);
		ListInvoiceAddRs = message.InvoiceAddRs;
		console.log("ListInvoiceAddRs=" + ListInvoiceAddRs);
		currentInvoiceIndex = 0;
		processNextInvoiceResponse();
	}
	
	function processNextInvoiceResponse(){
		console.log("currentInvoiceIndex=" +currentInvoiceIndex);
		if (messagePopup!=null&& messagePopup!=""){
			$("#currentTask").html(messagePopup);
		}
			if (!ListInvoiceAddRs.length && currentInvoiceIndex==1){
				upNext();
				return;
			}else if (currentInvoiceIndex == ListInvoiceAddRs.length){
				upNext();
				return;
			}
		if (ListInvoiceAddRs.length){
			InvoiceAddRs =ListInvoiceAddRs[currentInvoiceIndex]
		}else{
			InvoiceAddRs = ListInvoiceAddRs;
		}
		console.log("InvoiceAddRs=" + JSON.stringify(InvoiceAddRs));
		var statusMessage =InvoiceAddRs.statusMessage;
		if (statusMessage == "Status OK"	){
			currentInvoice = convertInvoiceFromQB(InvoiceAddRs.InvoiceRet);
			if (extraDatas[currentInvoice.refNumber] && extraDatas[currentInvoice.refNumber]!=""){
				consumeWS("", "JSON", function(message){console.log(JSON.stringify(message));}, null, null, "[" +extraDatas[currentInvoice.refNumber]+"]");
			}
			currentInvoice.origin = "synch";
			
			invoiceDAO.store([currentInvoice],errorInvoiceDB,function(){
				invoiceDAO.delete(currentInvoice.refNumber,errorInvoiceDB, processedInvoice);
			});
		}else{
			if ( InvoiceAddRs.statusCode=="3231" ){
					messagePopup += "Invoice " + InvoiceAddRs.requestID + ":" + statusMessage + "<br>";
					processNextInvoiceResponse();
			}else {
				invoiceDAO.markSynchronizedError(InvoiceAddRs.requestID, errorInvoiceDB,function(){
					currentInvoiceIndex++;
					messagePopup += "Fail to upload invoice " + InvoiceAddRs.requestID + ":" + statusMessage + "<br>";
					messagePopup += "This invoice must be corrected and send it again<br>";
					processNextInvoiceResponse();
				});
			}
		}
	}
	
	function processedInvoice(){
		currentInvoiceIndex++;
		messagePopup += "Success upload Invoice " + InvoiceAddRs.requestID + "<br>";
		processNextInvoiceResponse();
	}
	

	function	errorInvoiceDB(err) {
		messagePopup += "Fail to store invoice " + InvoiceAddRs.requestID + ":" + JSON.stringify(err) + "<br>";
		currentInvoiceIndex++;
		processNextInvoiceResponse();
	}

//Synchronizaction UP creditMemos
	function syncUpCreditMemos(form){
		console.log("entre a syncUpCreditMemos");
		var mensaje = "";
		extraDatas = new Array();
		creditMemoDAO.listToUpload(function(results){
			console.log("syncUpCreditMemos results=" + results);
			for (var i in results){
				var rec = results[i];
				console.log("syncUpCreditMemos creditMemo["+ i + "]=" + JSON.stringify(rec));
				mensaje += '<CreditMemoAddRq requestID="' + rec.refNumber+ '"><CreditMemoAdd>'+
					'<CustomerRef><ListID>' + rec.ListID + '</ListID></CustomerRef>'+
					'<TxnDate>'+rec.shipDate+'</TxnDate>'+
					'<RefNumber>'+rec.refNumber+'</RefNumber>'+
					'<TermsRef><ListID>'+rec.id_term+ '</ListID></TermsRef>'+
					'<DueDate>'+rec.dueDate+'</DueDate>'+
					'<SalesRepRef><ListID>' +rec.id_salesrep+'</ListID></SalesRepRef>'+
					'<Memo>' +rec.memo+'</Memo>';
					if (rec.customerMsg_ListID){
						mensaje+='<CustomerMsgRef><ListID>' +rec.customerMsg_ListID + '</ListID></CustomerMsgRef>';
					}
					if (rec.SalesTax_ListID){
						mensaje+='<CustomerSalesTaxCodeRef><ListID>' + rec.SalesTax_ListID + '</ListID></CustomerSalesTaxCodeRef>';
					}
					console.log("antes del for");
				for (var j in rec.items){
					console.log("dentro del for1");
					var item=rec.items[j];
					console.log("dentro del for2");
					console.log("item x=" + JSON.stringify(item));
					console.log("item.class_ListID=" + item.class_ListID);
					mensaje += '<CreditMemoLineAdd><ItemRef><ListID>' + item.Inventory_ListID +'</ListID></ItemRef>';
					mensaje += '<Quantity>' + item.Quantity + '</Quantity>';
					mensaje += '<Rate>' + item.Rate + '</Rate>';
					mensaje += '<ClassRef><ListID>' + item.class_ListID + '</ListID></ClassRef>';
					if (item.InventorySite_ListID){
						mensaje += '<InventorySiteRef><ListID>' + item.InventorySite_ListID+ '</ListID></InventorySiteRef>';
					}
					mensaje += '</CreditMemoLineAdd>';
				}
				mensaje += '</CreditMemoAdd></CreditMemoAddRq>';
				if (rec.photo!=null && rec.photo!=''){
					extraDatas[rec.refNumber] =  "{\"type\":\"creditMemoPhoto\",\"refNumber\":\"" + rec.refNumber + "\"" +
					",\"companyName\":\"" + rec.companyName +  "\"" +
					",\"date\":\"" + rec.txnDate + "\"" +
					",\"data\":\"" +rec.photo + "\"}";
				}
			}
			
			console.log("syncUpCreditMemos mensaje=" +  mensaje)
			
			consumeWS(mensaje, "JSON", receiveSyncUpCreditMemosMessage, null, null, null);
		});
		return false;
	}
	
	var CreditMemoAddRs;
	var ListCreditMemoAddRs;
	var currentCreditMemoIndex;
	var currentCreditMemo;
	function receiveSyncUpCreditMemosMessage(message){
		console.log('receiveSyncUpCreditMemosMessage message=' + message);
		ListCreditMemoAddRs = message.CreditMemoAddRs;
		console.log("ListCreditMemoAddRs=" + ListCreditMemoAddRs);
		currentCreditMemoIndex = 0;
		processNextCreditMemoResponse();
	}
	
	function processNextCreditMemoResponse(){
		console.log("currentCreditMemoIndex=" +currentCreditMemoIndex);
		if (messagePopup!=null&& messagePopup!=""){
			$("#currentTask").html(messagePopup);
		}
			if (!ListCreditMemoAddRs.length && currentCreditMemoIndex==1){
				upNext();
				return;
			}else if (currentCreditMemoIndex == ListCreditMemoAddRs.length){
				upNext();
				return;
			}
		if (ListCreditMemoAddRs.length){
			CreditMemoAddRs =ListCreditMemoAddRs[currentCreditMemoIndex]
		}else{
			CreditMemoAddRs = ListCreditMemoAddRs;
		}
		console.log("CreditMemoAddRs=" + JSON.stringify(CreditMemoAddRs));
		var statusMessage =CreditMemoAddRs.statusMessage;
		if (statusMessage == "Status OK"	){
			currentCreditMemo = convertCreditMemoFromQB(CreditMemoAddRs.CreditMemoRet);
			if (extraDatas[currentCreditMemo.refNumber] && extraDatas[currentCreditMemo.refNumber]!=""){
				consumeWS("", "JSON", function(message){console.log(JSON.stringify(message));}, null, null, "[" +extraDatas[currentCreditMemo.refNumber]+"]");
			}
			currentCreditMemo.origin = "synch";
			
			creditMemoDAO.store([currentCreditMemo],errorCreditMemoDB,function(){
				creditMemoDAO.delete(currentCreditMemo.refNumber,errorCreditMemoDB, processedCreditMemo);
			});
		}else{
			if ( CreditMemoAddRs.statusCode=="3231" ){
					messagePopup += "CreditMemo " + CreditMemoAddRs.requestID + ":" + statusMessage + "<br>";
					processNextCreditMemoResponse();
			}else {
				creditMemoDAO.markSynchronizedError(CreditMemoAddRs.requestID, errorCreditMemoDB,function(){
					currentCreditMemoIndex++;
					messagePopup += "Fail to upload creditMemo " + CreditMemoAddRs.requestID + ":" + statusMessage + "<br>";
					messagePopup += "This creditMemo must be corrected and send it again<br>";
					processNextCreditMemoResponse();
				});
			}
		}
	}
	
	function processedCreditMemo(){
		currentCreditMemoIndex++;
		messagePopup += "Success upload CreditMemo " + CreditMemoAddRs.requestID + "<br>";
		processNextCreditMemoResponse();
	}
	

	function	errorCreditMemoDB(err) {
		messagePopup += "Fail to store creditMemo " + CreditMemoAddRs.requestID + ":" + JSON.stringify(err) + "<br>";
		currentCreditMemoIndex++;
		processNextCreditMemoResponse();
	}

//Synchronizaction UP customers
	var CustomerModRs;
	var CustomerAddRs;
	var ListCustomerModRs;
	var ListCustomerAddRs;
	var currentCustomerModIndex;
	var currentCustomerAddIndex;
	var endCustomerAdd;
	var endCustomerMod;
	var qbxmlRouteDays="";
	var hashRoutedays;
	function syncUpCustomers(form){
		console.log("entre a syncUpCustomers");
		hashRoutedays = new Object();
		var mensaje = "";
		qbxmlRouteDays="";
		customerDAO.listAllToUpload(function(results){
			console.log("syncUpCustomers results = " + JSON.stringify(results));
			for (var i in results){
				var rec = results[i];
				console.log("syncUpCustomers customer["+ i + "]=" + JSON.stringify(rec));
				if (rec.origin=="remote"){
					mensaje += '<CustomerModRq requestID="' + rec.ListID + '"><CustomerMod>';
					mensaje +='<ListID>' + rec.ListID + '</ListID>';
				}else{
					mensaje += '<CustomerAddRq requestID="' + rec.ListID + '"><CustomerAdd>';
				}
				if (rec.origin=="remote"){
					mensaje +='<EditSequence>'+ rec.editSequence + '</EditSequence>';
				}
				mensaje +=fillXMLTag('Name',rec.FullName, true, true)
					+fillXMLTag('CompanyName',rec.companyName, true, true)
					+'<BillAddress>'
					+fillXMLTag('Addr1',rec.billAddress1,true,true)
					+fillXMLTag('Addr2',rec.billAddress2,true,true)
					+fillXMLTag('Addr3',rec.billAddress3,true,true)
					+fillXMLTag('City',rec.billAddresscity,true,true)
					+fillXMLTag('State',rec.billAddressState,true,true)
					+fillXMLTag('PostalCode',rec.billAddressZipCode,true,true)
					+fillXMLTag('Country',rec.billAddressCountry,true,true)
					+'</BillAddress>'
					+'<ShipAddress>'
					+fillXMLTag('Addr1',rec.shipAddress1,true,true)
					+fillXMLTag('Addr2',rec.shipAddress2,true,true)
					+fillXMLTag('Addr3',rec.shipAddress3,true,true)
					+fillXMLTag('City',rec.shipAddressCity,true,true)
					+fillXMLTag('State',rec.shipAddressState,true,true)
					+fillXMLTag('PostalCode',rec.shipAddressZipcode,true,true)
					+fillXMLTag('Country',rec.shipAddressCountry,true,true)
					+'</ShipAddress>'
					+fillXMLTag('Phone',rec.workPhone,true,true)
					+fillXMLTag('AltPhone',rec.cellPhone,true,true)
					+fillXMLTag('Fax',rec.Fax,true,true)
					+fillXMLTag('Email',rec.email,true,true)
					+'<TermsRef><ListID>'+rec.id_term+'</ListID></TermsRef>'
					+'<SalesRepRef><ListID>'+rec.id_salesrep+'</ListID></SalesRepRef>';
					if (rec.pricelevel_ListID && ""!=rec.pricelevel_ListID){
						mensaje +='<PriceLevelRef><ListID>'+rec.pricelevel_ListID+'</ListID></PriceLevelRef>';
					}
					if (rec.origin=="remote"){
						mensaje +='</CustomerMod></CustomerModRq>';
					}else{
						mensaje +='</CustomerAdd></CustomerAddRq>';
					}
					if (rec.routeDay1 + rec.routeDay1 + rec.routeDay3 +rec.routeDay4 + rec.routeDay5 + rec.routeDay6 + rec.routeDay7 >0){
						var msg = "";
						if (rec.origin=="remote"){
							msg += '<DataExtModRq><DataExtMod>';
						}else{
							msg += '<DataExtAddRq><DataExtAdd>';
						}
						msg +='<OwnerID>0</OwnerID>'
								+'<DataExtName>RouteDay</DataExtName>'
								+'<ListDataExtType>Customer</ListDataExtType>'
								+'<ListObjRef><ListID>' + rec.ListID +  '</ListID></ListObjRef>'
								+'<DataExtValue>'+(rec.routeDay1==1?'SUN,':'')+(rec.routeDay2==1?'MON,':'')+(rec.routeDay3==1?'TUE,':'')+(rec.routeDay4==1?'WED,':'')+(rec.routeDay5==1?'THU,':'')+(rec.routeDay6==1?'FRI,':'')+(rec.routeDay7==1?'SAT':'')+'</DataExtValue>';
						if (rec.origin=="remote"){
							msg+='</DataExtMod></DataExtModRq>';
						}else{
							msg+='</DataExtAdd></DataExtAddRq>';
						}
						console.log("add hashRoutedays=" + msg);
						var routeInfo = {
							qbxml: msg,
							routeDay1:rec.routeDay1,
							routeDay2:rec.routeDay2,
							routeDay3:rec.routeDay3,
							routeDay4:rec.routeDay4,
							routeDay5:rec.routeDay5,
							routeDay6:rec.routeDay6,
							routeDay7:rec.routeDay7
						}
						hashRoutedays[rec.ListID] = routeInfo;
					}
			}
			
			console.log("syncUpCustomers mensaje=" +  mensaje)
			
			consumeWS(mensaje, "JSON", receiveSyncUpCustomersMessage, null, null, null);
		});
		return false;
	}
	
	function receiveSyncUpCustomersMessage(message){
		console.log('receiveSyncUpCustomersMessage message=' + message);
		ListCustomerModRs = message.CustomerModRs;
		ListCustomerAddRs = message.CustomerAddRs;
		if ((ListCustomerModRs==null || typeof ListCustomerModRs == "undefined") && (ListCustomerAddRs==null || typeof ListCustomerAddRs == "undefined")){
			messagePopup += "No data returned by server.  An error ocurred";
			$("#currentTask").html(messagePopup);
			return;
		}
		console.log("ListCustomerModRs=" + ListCustomerModRs);
		if (ListCustomerModRs!=null && typeof ListCustomerModRs != "undefined"){
			currentCustomerModIndex = 0;
			endCustomerMod = false;
			processNextCustomerModResponse();
		}else{
			endCustomerMod = true;
		}
		
		maxWaitEndCustomer = 200;
		waitEndCustomerMod();

		//send qbxml de routedays
		maxWaitEndCustomer = 200;
		setTimeout("waitEndCustomerSyncUp()",200);
		
	}
	
	function waitEndCustomerMod(){
		console.log("waitEndCustomerMod");
		if (maxWaitEndCustomer>0){
	
			maxWaitEndCustomer--;
	
			if (!endCustomerMod){
				setTimeout("waitEndCustomerMod()",200);
				return;
			}
		}
		
		console.log("ListCustomerAddRs=" + ListCustomerAddRs);
		if (ListCustomerAddRs!=null && typeof ListCustomerAddRs != "undefined"){
			currentCustomerAddIndex = 0;
			endCustomerAdd = false;
			processNextCustomerAddResponse();
		}else {
			endCustomerAdd = true;
		}
		
		
	}
	
	var maxWaitEndCustomer;
	var endCustomerRouteAdd;
	function waitEndCustomerSyncUp(){
		if (maxWaitEndCustomer>0){
			maxWaitEndCustomer--;
			if (endCustomerAdd && endCustomerMod){
				console.log("send qbxmlRouteDays=" + qbxmlRouteDays);
				messagePopup += "<B> Sync up customers routes...</B>";
				$("#currentTask").html(messagePopup);
				if (qbxmlRouteDays!=""){
					consumeWS(qbxmlRouteDays, "JSON", receiveSyncUpRouteDays, null, null, null);
					maxWaitEndSyncUpRoute=200;
					endCustomerRouteAdd = false;
					waitEndSyncUpRouteDays();
				}else{
					upNext();
				}

			}else{
				console.log("esperar waitEndCustomerSyncUp");
				setTimeout("waitEndCustomerSyncUp()",200);
			}
		}
	}
	
	function receiveSyncUpRouteDays(message){
		console.log("receiveSyncUpRouteDays message=" + JSON.stringify(message));
		endCustomerRouteAdd=true;
	}
	
	var maxWaitEndSyncUpRoute;
	function waitEndSyncUpRouteDays(){
		if (maxWaitEndSyncUpRoute>0){
			maxWaitEndSyncUpRoute--;
			if (endCustomerRouteAdd){
				upNext();
			}else{
				console.log("esperar waitEndSyncUpRouteDays");
				setTimeout("waitEndSyncUpRouteDays()",1000);
			}
		}else{
			upNext();
		}
		
	}
	
	function processNextCustomerModResponse(){
		console.log("currentCustomerModIndex=" +currentCustomerModIndex);
		if (messagePopup!=null&& messagePopup!=""){
			$("#currentTask").html(messagePopup);
		}
			if (!ListCustomerModRs.length && currentCustomerModIndex>=1){
				endCustomerMod = true;
				return;
			}else if (currentCustomerModIndex == ListCustomerModRs.length){
				endCustomerMod = true;
				return;
			}
		if (ListCustomerModRs.length){
			CustomerModRs =ListCustomerModRs[currentCustomerModIndex]
		}else{
			CustomerModRs = ListCustomerModRs;
		}
		console.log("CustomerModRs=" + JSON.stringify(CustomerModRs));
		var statusMessage =CustomerModRs.statusMessage;
		if (statusMessage == "Status OK"	){
			var customer = CustomerModRs.CustomerRet;
			var customerVO = convertCustomerQB(customer);
			if (hashRoutedays[CustomerModRs.requestID]){
				routeInfo = hashRoutedays[CustomerModRs.requestID];
				customerVO.routeDay1 = routeInfo.routeDay1;
				customerVO.routeDay2 = routeInfo.routeDay2;
				customerVO.routeDay3 = routeInfo.routeDay3;
				customerVO.routeDay4 = routeInfo.routeDay4;
				customerVO.routeDay5 = routeInfo.routeDay5;
				customerVO.routeDay6 = routeInfo.routeDay6;
				customerVO.routeDay7 = routeInfo.routeDay7;
			}
			
			customerDAO.store([customerVO],errorCustomerModDB,function(){
				customerDAO.markSynchronized( CustomerModRs.requestID,errorCustomerModDB,processedCustomerMod);
			},'remote');
		}else{
			if ( CustomerModRs.statusCode=="3231" ){
					messagePopup += "Customer " + CustomerModRs.requestID + ":" + statusMessage + "<br>";
					processNextCustomerModResponse();
			}else {
				customerDAO.markSynchronizedError(CustomerModRs.requestID, errorCustomerModDB,function(){
					currentCustomerModIndex++;
					messagePopup += "Fail to upload customer " + CustomerModRs.requestID + ":" + statusMessage + "<br>";
					messagePopup += "This customer must be corrected and send it again<br>";
					processNextCustomerModResponse();
				});
			}
		}
	}
	
	function processedCustomerMod(){
		currentCustomerModIndex++;
		messagePopup += "Success upload Customer " + CustomerModRs.CustomerRet.FullName + "<br>";
		var msg =  hashRoutedays[CustomerModRs.requestID];
		console.log("CustomerModRs.requestID=" + CustomerModRs.requestID);
		if (msg){
			qbxmlRouteDays += msg.qbxml;
		}
		console.log("add a qbxmlRouteDays=" + hashRoutedays[CustomerModRs.requestID]);
		processNextCustomerModResponse();
	}

	function	errorCustomerModDB(err) {
		messagePopup += "Fail to store customer " + CustomerAddRs.requestID + ":" + JSON.stringify(err) + "<br>";
		currentCustomerModIndex++;
		processNextCustomeModResponse();
	}
	
	function processNextCustomerAddResponse(){
		console.log("processNextCustomerAddResponse currentCustomerAddIndex=" +currentCustomerAddIndex + ",ListCustomerAddRs.length=" + ListCustomerAddRs.length);
		if (messagePopup!=null&& messagePopup!=""){
			$("#currentTask").html(messagePopup);
		}
			if (typeof ListCustomerAddRs.length == "undefined" && currentCustomerAddIndex>=1){
				console.log("processNextCustomerAddResponse return");
				endCustomerAdd = true;
				return;
			}else if (currentCustomerAddIndex >= ListCustomerAddRs.length){
				endCustomerAdd = true;
				return;
			}
		if (ListCustomerAddRs.length){
			CustomerAddRs =ListCustomerAddRs[currentCustomerAddIndex]
		}else{
			CustomerAddRs = ListCustomerAddRs;
		}
		console.log("CustomerAddRs=" + JSON.stringify(CustomerAddRs));
		var statusMessage =CustomerAddRs.statusMessage;
		if (statusMessage == "Status OK"	){
			var customer = CustomerAddRs.CustomerRet;
			var customerVO = convertCustomerQB(customer);
			if (hashRoutedays[CustomerAddRs.requestID]){
				routeInfo = hashRoutedays[CustomerAddRs.requestID];
				customerVO.routeDay1 = routeInfo.routeDay1;
				customerVO.routeDay2 = routeInfo.routeDay2;
				customerVO.routeDay3 = routeInfo.routeDay3;
				customerVO.routeDay4 = routeInfo.routeDay4;
				customerVO.routeDay5 = routeInfo.routeDay5;
				customerVO.routeDay6 = routeInfo.routeDay6;
				customerVO.routeDay7 = routeInfo.routeDay7;
			}
			;
			customerDAO.store([customerVO],errorCustomerAddDB,function(){
				customerDAO.move(CustomerAddRs.requestID, customerVO.ListID,errorCustomerAddDB,processedCustomerAdd);
			}, 'remote');
		}else{
			if ( CustomerAddRs.statusCode=="3231" ){
					messagePopup += "Customer " + CustomerAddRs.requestID + ":" + statusMessage + "<br>";
					processNextCustomerAddResponse();
			}else {
				customerDAO.markSynchronizedError(CustomerAddRs.requestID, errorCustomerAddDB,function(){
					currentCustomerAddIndex++;
					messagePopup += "Fail to upload customer " + CustomerAddRs.requestID + ":" + statusMessage + "<br>";
					messagePopup += "This customer must be corrected and send it again<br>";
					processNextCustomerAddResponse();
				});
			}
		}
	}
	
	function processedCustomerAdd(){
		currentCustomerAddIndex++;
		messagePopup += "<br>Success upload Customer " + CustomerAddRs.CustomerRet.FullName + "<br>";
		console.log("CustomerAddRs.requestID=" + CustomerAddRs.requestID);
		var msg = hashRoutedays[CustomerAddRs.requestID];
		if (msg){
			msg = msg.qbxml;
			
			qbxmlRouteDays +=  msg.replace(CustomerAddRs.requestID,CustomerAddRs.CustomerRet.ListID);
			console.log("add a qbxmlRouteDays=" + msg);
		}
		processNextCustomerAddResponse();
	}

	function	errorCustomerAddDB(err) {
		messagePopup += "<br>Fail to store customer " + CustomerAddRs.requestID + ":" + JSON.stringify(err) + "<br>";
		currentCustomerAddIndex++;
		processNextCustomeAddResponse();
	}

//SYNCHRONIZATION CreditMemos	
	function syncCreditMemos(form){
		console.log("entre a syncCreditMemos");
		salesRepDAO.getByName(window.localStorage.getItem("salesRepName"), function(salesrepVO){
		logZoe("en syncCreditMemos salesrepVO = " + JSON.stringify(salesrepVO));
		var mensaje = 	
		'<CreditMemoQueryRq requestID="creditMemo001"></CreditMemoQueryRq>';
		var cache="creditMemo";
		var xpathExp = '//CreditMemoRet[SalesRepRef/ListID="'+ salesrepVO.id_salesrep + '"]';
		
		consumeWS(mensaje, "JSON", receiveCreditMemosMessage, cache, xpathExp);
		});
		return false;
	}
	
	var creditMemosVO = [];
	function receiveCreditMemosMessage(message){
		var creditMemos = message.CreditMemoQueryRs.CreditMemoRet;
		var i;
		creditMemosVO = [];
		for (i=0;creditMemos && i<creditMemos.length;i++){
			var creditMemo = creditMemos[i];
			
			var creditMemoVO = convertCreditMemoFromQB(creditMemo);
			creditMemoVO.origin = "remote";
			creditMemosVO[i] = creditMemoVO;
				
		}
			
		creditMemoDAO.deleteAll(errCreditMemoInsert,storeCreditMemos);
	}
	
	function storeCreditMemos(){
		creditMemoDAO.store(creditMemosVO, errCreditMemoInsert, successCreditMemoInsert,'remote');
	}
	


	function convertCreditMemoFromQB(creditMemo){
			logZoe("creditMemo=" + JSON.stringify(creditMemo));
			logZoe("creditMemo.TermsRef=" + JSON.stringify(creditMemo.TermsRef));
			if (creditMemo.TermsRef)
				logZoe("creditMemo.TermsRef.ListID=" + JSON.stringify(creditMemo.TermsRef.ListID));
			
			var creditMemoVO = {
				id_creditMemo:creditMemo.TxnID,
				ListID : creditMemo.CustomerRef.ListID,
				po_number : creditMemo.PONumber,
				dueDate : creditMemo.DueDate,
				appliedAmount : creditMemo.AppliedAmount,
				txnDate: creditMemo.TxnDate,
				balanceRemaining : creditMemo.CreditRemaining,
				billAddress_addr1 : creditMemo.BillAddress?creditMemo.BillAddress.Addr1:null,
				billAddress_addr2 :creditMemo.BillAddress?creditMemo.BillAddress.Addr2:null,
				billAddress_addr3 : creditMemo.BillAddress?creditMemo.BillAddress.Addr3:null,
				billAddress_city : creditMemo.BillAddress?creditMemo.BillAddress.City:null,
				billAddress_state : creditMemo.BillAddress?creditMemo.BillAddress.State:null,
				billAddress_postalcode : creditMemo.BillAddress?creditMemo.BillAddress.PostalCode:null,
				shipAddress_addr1 : creditMemo.BillAddress?creditMemo.BillAddress.addr1:null,
				shipAddress_addr2 : creditMemo.BillAddress?creditMemo.BillAddress.addr2:null,
				shipAddress_addr3 : creditMemo.BillAddress?creditMemo.BillAddress.addr3:null,
				shipAddress_city : creditMemo.BillAddress?creditMemo.BillAddress.City:null,
				shipAddress_state : creditMemo.BillAddress?creditMemo.BillAddress.State:null,
				shipAddress_postalcode : creditMemo.BillAddress?creditMemo.BillAddress.PostalCode:null,
				isPaid : creditMemo.IsPaid=="true"?1:0,
				isPending : creditMemo.IsPending=="true"?1:0,
				refNumber : creditMemo.RefNumber,
				TaxPercentage : creditMemo.SalesTaxPercentage,
				salesTaxTotal : creditMemo.SalesTaxTotal,
				shipDate : creditMemo.ShipDate,
				subtotal : creditMemo.Subtotal,
				customerMsg_ListID: creditMemo.CustomerMsgRef?creditMemo.CustomerMsgRef.ListID:null,
				id_salesrep:creditMemo.SalesRepRef?creditMemo.SalesRepRef.ListID:null,
				id_term: typeof creditMemo.TermsRef != "undefined"?creditMemo.TermsRef.ListID:null,
				items: new Array()
			}
			
			if (creditMemo.CreditMemoLineRet){
				var lines = new Array();
				if (creditMemo.CreditMemoLineRet.length){
					lines =  creditMemo.CreditMemoLineRet;
				}else{
					lines = [creditMemo.CreditMemoLineRet];
				}
				for (j=0;j<lines.length;j++){
					var line = lines[j];
					var itemVO = {
							LineID:line.TxnLineID,
							id_creditMemo:creditMemoVO.id_creditMemo,
							Inventory_ListID:line.ItemRef.ListID,
							Desc:line.Desc,
							Quantity:line.Quantity,
							Rate:line.Rate,
							Amount:line.Amount,
							SalesTax_ListID:line.SalesTaxCodeRef.ListID,
							class_ListID: typeof line.ClassRef != "undefined"?line.ClassRef.ListID:null,
					}
					creditMemoVO.items[j] = itemVO;
				}
			}
			return creditMemoVO;
	}


	function successCreditMemoInsert(){
		downNext();
	}
	
	function errCreditMemoInsert(err){
		alert("DB Error synch creditMemos: "+JSON.stringify(err));
	}



//SYNCHRONIZATION inventory

	function syncInventoryItems(form){
		console.log("entre a syncInventoryItems");
		var mensaje = 	
		'<ItemQueryRq></ItemQueryRq>';
		var cache="item";
		
		consumeWS(mensaje, "JSON", receiveInventoryItemsMessage, cache);
		return false;
	}

	function receiveInventoryItemsMessage(message){
		var items = message.ItemQueryRs.ItemInventoryRet;
		var i;
		var itemListVO = [];
		for (i=0;i<items.length;i++){
			logZoe("items[i]=" + JSON.stringify(items[i]));
			var itemVO = {ListID:items[i].ListID,
			FullName:items[i].FullName+"",
			salesDesc:items[i].SalesDesc,
			inventorySite_ListID:null,
			quantityOnHand:null,
			salesTax_ListID:items[i].SalesTaxCodeRef?items[i].SalesTaxCodeRef.ListID:null,
			salesPrice:items[i].SalesPrice};
			itemListVO[i] = itemVO;
		}
			
		inventoryDAO.deleteAll(errInventoryInsert);
		inventoryDAO.store(itemListVO, errInventoryInsert, syncItemSites);
		
	}
	

	function syncItemSites(form){
		console.log("entre a syncItemSites");
		salesRepDAO.getByName(window.localStorage.getItem("salesRepName"), function(salesrepVO){
		logZoe("en syncInventory salesrepVO = " + JSON.stringify(salesrepVO));
		var mensaje = 	
		'<ItemSitesQueryRq><ActiveStatus>All</ActiveStatus></ItemSitesQueryRq>';
		var cache="inventorybysite";
		var xpathExp = '//ItemSitesRet[InventorySiteRef/FullName="'+ salesrepVO.initial + '"]';
		
		consumeWS(mensaje, "JSON", receiveItemSitesMessage, cache, xpathExp);
		});
		return false;
	}

	function receiveItemSitesMessage(message){
		var inventory = message.ItemSitesQueryRs.ItemSitesRet;
		var i;
		var inventoryListVO = [];
		for (i=0;i<inventory.length;i++){
			logZoe("inventory[i]=" + JSON.stringify(inventory[i]));
			var inventoryVO = {ListID:inventory[i].ItemInventoryRef.ListID,
			InventorySite_ListID:inventory[i].InventorySiteRef?inventory[i].InventorySiteRef.ListID:null,
			QuantityOnHand:inventory[i].QuantityOnHand};
			logZoe("inventoryVO=" + JSON.stringify(inventoryVO));
			inventoryListVO[i] = inventoryVO;
		}
			
		inventoryDAO.storeItemSites(inventoryListVO, errInventoryInsert, successInventoryInsert);
		
	}


	function successInventoryInsert(){
		downNext();
	}
	
	function errInventoryInsert(err){
		alert("DB Error synch inventory: "+JSON.stringify(err));
	}

//SYNCHRONIZATION Terms	
	function syncTerms(form){
		console.log("entre a syncTerms");
		var mensaje = 	
		'<TermsQueryRq  requestID="Term1"><ActiveStatus>ActiveOnly</ActiveStatus></TermsQueryRq>';
		var cache="term";
		
		consumeWS(mensaje, "JSON", receiveTermsMessage, cache);
		return false;
	}

	function receiveTermsMessage(message){
		var terms = message.TermsQueryRs.StandardTermsRet;
		var i;
		var termsVO = [];
		for (i=0;i<terms.length;i++){
			logZoe("terms[i]=" + JSON.stringify(terms[i]));
			var termVO = {
				id_term:terms[i].ListID,
				name : terms[i].Name,
				stdDueDays : terms[i].StdDueDays,
				stdDiscountDays : terms[i].StdDiscountDays,
				discountPct : terms[i].DiscountPct
			}
			termsVO[i] = termVO;
			
		}
			
		termDAO.deleteAll(errTermInsert);
		termDAO.store(termsVO, errTermInsert, successTermInsert);
	}


	function successTermInsert(){
		downNext();
	}
	
	function errTermInsert(err){
		alert("DB Error synch terms: "+JSON.stringify(err));
	}


//SYNCHRONIZATION Taxes	
	function syncTaxes(form){
		console.log("entre a syncTaxes");
		var mensaje = 	
		'<SalesTaxCodeQueryRq  requestID="tax1"><ActiveStatus>ActiveOnly</ActiveStatus></SalesTaxCodeQueryRq>';
		var cache="tax";
		
		consumeWS(mensaje, "JSON", receiveTaxesMessage, cache);
		return false;
	}

	function receiveTaxesMessage(message){
		var taxes = message.SalesTaxCodeQueryRs.SalesTaxCodeRet;
		var i;
		var taxesVO = [];
		for (i=0;i<taxes.length;i++){
			logZoe("taxes[i]=" + JSON.stringify(taxes[i]));
			var taxVO = {
				ListID:taxes[i].ListID,
				name : taxes[i].Name,
				desc : taxes[i].Desc
			}
			taxesVO[i] = taxVO;
			
		}
			
		taxDAO.deleteAll(errTaxInsert);
		taxDAO.store(taxesVO, errTaxInsert, successTaxInsert);
	}


	function successTaxInsert(){
		downNext();
	}
	
	function errTaxInsert(err){
		alert("DB Error synch tax: "+JSON.stringify(err));
	}
	
// sync down class
	function syncClasses(form){
		console.log("entre a syncClasses");
		var mensaje = 	
		'<ClassQueryRq  requestID="Class1"><ActiveStatus>ActiveOnly</ActiveStatus></ClassQueryRq>';
		var cache="class";
		
		consumeWS(mensaje, "JSON", receiveClassesMessage, cache);
		return false;
	}

	function receiveClassesMessage(message){
		var classes = message.ClassQueryRs.ClassRet;
		var i;
		var classesVO = [];
		var j = 0;
		for (i=0;i<classes.length;i++){
			logZoe("classes[i]=" + JSON.stringify(classes[i]));
			var n = classes[i].Name.toUpperCase();
			if (n.indexOf("DM-")==0 || n.indexOf("GD-")==0){
				var type = n.indexOf("DM-")==0?"DAMAGE":"GOOD";
				n = classes[i].Name.substring(3);
				var classVO = {
					ListID:classes[i].ListID,
					Name : n,
					Type : type
				}
				classesVO[j] = classVO;
				j++;
			}
		}
			
		classDAO.deleteAll(errClassInsert);
		classDAO.store(classesVO, errClassInsert, successClassInsert);
	}


	function successClassInsert(){
		downNext();
	}
	
	function errClassInsert(err){
		alert("DB Error synch classes: "+JSON.stringify(err));
	}

// sync down inventorySite
	function syncInventorySite(form){
		console.log("entre a syncInventorySite");
		var mensaje = 	
		'<InventorySiteQueryRq  requestID="InventorySite1"><ActiveStatus>ActiveOnly</ActiveStatus></InventorySiteQueryRq>';
		var cache="inventorysite";
		
		consumeWS(mensaje, "JSON", receiveInventorySiteMessage, cache);
		return false;
	}

	function receiveInventorySiteMessage(message){
		var InventorySite = message.InventorySiteQueryRs.InventorySiteRet;
		var i;
		var InventorySiteVO = [];
		var j = 0;
		for (i=0;i<InventorySite.length;i++){
			logZoe("InventorySite[i]=" + JSON.stringify(InventorySite[i]));
			var inventorySiteVO = {
				ListID:InventorySite[i].ListID,
				Name : InventorySite[i].Name+"",
				SiteDesc : InventorySite[i].SiteDesc
			}
			InventorySiteVO[i] = inventorySiteVO;
		}
			
		inventorySiteDAO.deleteAll(errInventorySiteInsert);
		inventorySiteDAO.store(InventorySiteVO, errInventorySiteInsert, successInventorySiteInsert);
	}


	function successInventorySiteInsert(){
		downNext();
	}
	
	function errInventorySiteInsert(err){
		alert("DB Error synch InventorySite: "+JSON.stringify(err));
	}

//SYNCHRONIZATION PaymentMethods	
	function syncPaymentMethods(form){
		console.log("entre a syncPaymentMethods");
		var mensaje = 	
		'<PaymentMethodQueryRq  requestID="PaymentMethod1"><ActiveStatus>ActiveOnly</ActiveStatus></PaymentMethodQueryRq>';
		var cache="paymentmethod";
		
		consumeWS(mensaje, "JSON", receivePaymentMethodsMessage, cache);
		return false;
	}

	function receivePaymentMethodsMessage(message){
		var paymentMethods = message.PaymentMethodQueryRs.PaymentMethodRet;
		var i;
		var paymentMethodsVO = [];
		for (i=0;i<paymentMethods.length;i++){
			logZoe("paymentMethods[i]=" + JSON.stringify(paymentMethods[i]));
			var paymentMethodVO = {
				ListID:paymentMethods[i].ListID,
				name : paymentMethods[i].Name,
				type : paymentMethods[i].PaymentMethodType
			}
			paymentMethodsVO[i] = paymentMethodVO;
			
		}
			
		paymentMethodDAO.deleteAll(errPaymentMethodInsert);
		paymentMethodDAO.store(paymentMethodsVO, errPaymentMethodInsert, successPaymentMethodInsert);
	}


	function successPaymentMethodInsert(){
		downNext();
	}
	
	function errPaymentMethodInsert(err){
		alert("DB Error synch paymentMethods: "+JSON.stringify(err));
	}

//SYNCHRONIZATION pricelevel	
	function syncPricelevel(form){
		console.log("entre a syncPricelevel");
		var mensaje = '<PriceLevelQueryRq  requestID="pl"></PriceLevelQueryRq>';
		var cache="pricelevel";
		
		consumeWS(mensaje, "JSON", receivePricelevelMessage, cache);
		return false;
	}

	function receivePricelevelMessage(message){
		var pricelevels = message.PriceLevelQueryRs.PriceLevelRet;
		if (!pricelevels){
			console.log("ERROR: NO pricelevels!");
			return;
		}
		var i;
		var pricelevelsVO = [];
		for (i=0;i<pricelevels.length;i++){
			logZoe("pricelevel[i]=" + JSON.stringify(pricelevels[i]));
			var pricelevelVO = {
				ListID: pricelevels[i].ListID,
				name : pricelevels[i].Name,
				type : pricelevels[i].PriceLevelType,
				fixedPercentage : pricelevels[i].PriceLevelFixedPercentage,
				items : new Array()
			}
			pricelevelsVO[i] = pricelevelVO;
			console.log("pricelevelVO.type=" + pricelevelVO.type);
			if (pricelevelVO.type=="PerItem"){
				var items = pricelevels[i].PriceLevelPerItemRet;
				console.log("items=" + items);
				var j;
				for (j=0;items && j<items.length;j++){
						var itemVO = {
							pricelevel_ListID: pricelevelVO.ListID,
							inventory_ListID: items[j].ItemRef.ListID,
							customPrice: items[j].CustomPrice
						}
						console.log("itemVO =" + JSON.stringify(itemVO));
						pricelevelsVO[i].items[j] = itemVO;
				}
			}
			
		}
		
		pricelevelDAO.deleteAll(errPricelevelInsert);
		pricelevelDAO.store(pricelevelsVO, errPricelevelInsert, successPricelevelInsert);
	}


	function successPricelevelInsert(){
		downNext();
	}
	
	function errPricelevelInsert(err){
		alert("DB Error synch princelevels: "+JSON.stringify(err));
	}
	
//SYNC CustomerMsgs

	function syncCustomerMsgs(form){
		console.log("entre a SyncCustomerMsgs");
		var mensaje = 	
		'<CustomerMsgQueryRq  requestID="customermsg1"></CustomerMsgQueryRq>';
		var cache="customerMsg";
		
		consumeWS(mensaje, "JSON", receiveCustomerMsgs, cache);
		return false;
	}

	function receiveCustomerMsgs(message){
		var customerMsgs = message.CustomerMsgQueryRs.CustomerMsgRet;
		var i;
		var customerMsgsVO = [];
		for (i=0;i<customerMsgs.length;i++){
			logZoe("customerMsgs[i]=" + JSON.stringify(customerMsgs[i]));
			var customerMsgVO = {
				ListID:customerMsgs[i].ListID,
				FullName : customerMsgs[i].Name
			}
			customerMsgsVO[i] = customerMsgVO;
		}
			
		customerMsgDAO.deleteAll(errCustomerMsgInsert);
		customerMsgDAO.store(customerMsgsVO, errCustomerMsgInsert, successCustomerMsgInsert);
	}


	function successCustomerMsgInsert(){
		downNext();
	}
	
	function errCustomerMsgInsert(err){
		alert("DB Error synch CustomerMsg: "+JSON.stringify(err));
	}
	

//SYNC Vendors

	function syncDownVendors(form){
		console.log("entre a syncDownVendors:" + JSON.stringify(vendorNames));
		var mensaje = 	
		'<VendorQueryRq  requestID="vendor1"></VendorQueryRq>';
		var cache="vendor";
		var xpathExp = "//VendorRet[";
		for (var i in vendorNames){
			xpathExp += 'translate(Name, "ABCDEFGHIJKLMNOPQRSTUVWXYZ", "abcdefghijklmnopqrstuvwxyz")="'  + vendorNames[i].toLowerCase() + '"';
			if (i<vendorNames.length-1)
			 xpathExp+=' or ';
		}
		xpathExp+=']';
		
		consumeWS(mensaje, "JSON", receiveVendors, cache,xpathExp);
		return false;
	}

	function receiveVendors(message){
		var vendors = message.VendorQueryRs.VendorRet;
		console.log("receiveVendors: " +  JSON.stringify(vendors));
		var i;
		var vendorsVO = [];
		if (vendors.length){
			for (i=0;i<vendors.length;i++){
				var vendorVO = assignVendorToVO(vendors[i]);
				vendorsVO[i] = vendorVO;
			}
		}else if (vendors){
				var vendorVO = assignVendorToVO(vendors);
				vendorsVO[0] = vendorVO;
		}
			
		customerDAO.updateVendor(vendorsVO);
		vendorDAO.deleteAll(errVendorInsert);
		vendorDAO.store(vendorsVO, errVendorInsert, successVendorInsert);
	}
	
	function assignVendorToVO(vendor){
			var vendorVO = {
				ListID:vendor.ListID,
				name : vendor.Name,
				addr1 : vendor.VendorAddress.Addr1,
				addr2 : vendor.VendorAddress.Addr2,
				addr3 : vendor.VendorAddress.Addr3,
				city : vendor.VendorAddress.City,
				state : vendor.VendorAddress.State,
				country : vendor.VendorAddress.Country
			}
			return vendorVO;
}


	function successVendorInsert(){
		downNext();
	}
	
	function errVendorInsert(err){
		alert("DB Error synch Vendor: "+JSON.stringify(err));
	}
	
	
	
</script>
</head>

<body>

        <div data-role="page" id="config" data-title="Config">
        
            <div data-role="content"> 
                <form method="post" id="configForm" data-ajax="true">
                    <lable for="salesRepName">Piloch Sales Rep Full Name</lable><input type="text" id="salesRepName" name="salesRepName" placeholder="salesRepName"><br>

                    <lable for="syncURL">Synchronization URL</lable><input type="text" id="syncURL" name="syncURL" placeholder="syncURL"><br>
                                 
                        <input id="submitConfig" type="submit" value="Save">
                </form>
				<a href="#popupCreateDB" data-rel="popup" data-position-to="window" data-role="button" data-inline="true" data-icon="check" data-theme="a" data-transition="flip">Create database</a>

				<div data-role="popup" id="popupMenu" data-theme="a">
					<div data-role="popup" id="popupCreateDB" data-theme="a" class="ui-corner-all">
						<form>
							<div style="padding:10px 20px;">
							  <h3>Please Write "CONFIRM" to confirm</h3>
					          <label for="un" class="ui-hidden-accessible">Please write CONFIRM:</label>
					          <input type="text" name="confirm" id="confirm" value="" placeholder="CONFIRM" data-theme="a" onKeyUp="if ($('#confirm').val()=='CONFIRM') $('#confirmCreateDBButton').prop('disabled',false); else $('#confirmCreateDBButton').prop('disabled', true);">

					    	  <button id="confirmCreateDBButton" type="button" data-theme="b" data-icon="check"  onClick="submitCreateDatabase(); $('#popupCreateDB').popup( 'close' ); $('#confirmCreateDBButton').prop('disabled', true); $('#confirm').val('')" disabled="true">Confirm</button>
							</div>
						</form>
					</div>
				</div>                
            </div>

            <label for="syncDownSelect">Download</label>
            <div class="ui-grid-a">
                <div class="ui-block-a"  style="width:85%">
                    <select name="syncDownSelect" id="syncDownSelect" multiple="multiple" data-native-menu="false" onChange="onChangeSyncDownSelect()">
                        <option data-placeholder="true">Choose what to download </option>
                        <option value="all">All</option>
                        <option value="syncTaxes">Taxes</option>
                        <option value="syncTerms">Terms</option>
                        <option value="syncClasses">Classes</option>
                        <option value="syncPaymentMethods">Payment Methods</option>
                        <option value="syncCustomerMsgs">Customer Messages</option>
                        <option value="syncDownSalesRep">Sales Rep</option>
                        <option value="syncDownCustomers">Customers</option>
                        <option value="syncDownInventory">Inventory</option>
                        <option value="syncDownInventorySite">InventorySite</option>
                        <option value="syncDownPricelevel">Pricelevel</option>
                        <option value="syncDownInvoices">Invoices</option>
                        <option value="syncDownCreditMemos">Credit Memos</option>
                    </select>
                  </div>
                  <div class="ui-block-b"  style="width:15%"><button class="ui-btn" id="syncDown" onclick="syncDown(); return false;">Go</button></div>
               </div>

        
		    <label for="syncUpSelect">Upload</label>
            <div class="ui-grid-a">
                <div class="ui-block-a" style="width:85%">
			    <select name="syncUpSelect" id="syncUpSelect" multiple="multiple" data-native-menu="false">
			        <option  data-placeholder="true">Choose what to upload</option>
			        <option value="syncUpCustomers">Upload Customers</option>
			        <option value="syncUpCreditMemos">Upload Credit Memos</option>
			        <option value="syncUpInvoices">Upload Invoices</option>
			    </select>
                  </div>
                  <div class="ui-block-b"  style="width:15%"><button class="ui-btn" id="syncUp" onclick="syncUp(); return false;">Go</button></div>
               </div>

    


<div data-role="popup" id="synchDialog"  data-dismissible="false" style="position:fixed; top:50px; left:25px; width:80%" >
    <div data-role="header" style="width:100%; position:absolute; top:0px">
    Synchronizing
    </div>
    <div role="main" class="ui-content">
		  <span id="currentTask">...</span>
  		<a href="#" class="ui-btn" data-rel="back" id="btnSynchDialog" onclick="cancelSync(); return false;">Cancel</a>
	</div>
</div>


<!-- divs de header, menu y footer-->
	<div data-role="header" data-position="fixed" data-id="theheader" class="app-header"></div>
    <div data-role="panel" data-display="overlay" data-position="left" id="menu" class="app-menu"></div>
	<div data-role="footer" data-position="fixed" data-id="thefooter" class="app-footer"></div>
<!-- fin divs -->

</div>

</body>
</html>
